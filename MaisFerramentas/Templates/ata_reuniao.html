<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Divs Arrastáveis</title>
    <style>
      /* .draggable {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 5px;
        /* cursor: move; 
      } */

      .dragging {
        opacity: 0.5;
      }

      .flex {
        display: flex;
      }
      .column {
        flex-direction: column;
      }
      .row {
        flex-direction: row;
      }
      .tamanho {
        width: 360px;
      }
      .div_img_icone {
        display: flex;
        border-radius: 50px;
        width: 50px;
        height: 50px;
        border: 1px solid black;
        background-image: url("https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSUb-j_tc0tQGYF8zBywQ2MXUFuh0PoqNWUL4qu8lTShtqo7IhFRBZhOlVmM1dKN0ospPs&usqp=CAU");
        background-size: 62px;
        background-repeat: no-repeat;
        background-position: -6px 4px;
        margin-right: 8px;
        /* background-color: rgba(255, 255, 255, 9.9); */
      }
      .div_img_icone_2 {
        display: flex;
        border-radius: 50px;
        width: 40px;
        height: 40px;
        border: 1px solid black;
        background-image: url("https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSUb-j_tc0tQGYF8zBywQ2MXUFuh0PoqNWUL4qu8lTShtqo7IhFRBZhOlVmM1dKN0ospPs&usqp=CAU");
        background-size: 50px;
        background-repeat: no-repeat;
        background-position: -5px 4px;
        margin-right: 8px;
        /* background-color: rgba(255, 255, 255, 9.9); */
      }

      .div_img_icone_whats {
        display: flex;
        border-radius: 50px;
        width: 31px;
        height: 31px;
        margin-right: -10px;
      }
      .justify {
        justify-content: center;
      }
      .align {
        align-items: center;
      }
      .direita {
        margin-left: auto;
      }
      #area_arrastavel {
        min-height: 100px; /* altura mínima para permitir arrastar até o final */
      }

      .img_icones {
        display: flex;
        border-radius: 50px;
        width: 60px;
        height: 60px;
        margin-left: -23px;
      }

      .campo_texto {
        width: 100%;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        border-color: #57afc5;
        font-size: medium;
        /* -webkit-text-fill-color: #002344; */
        /* width: 17rem; */
      }

      .campo_texto:focus {
        outline: none;
        border-color: #007bff;
      }
      .campo_titulo {
        font-weight: bold;
      }
      .div_card {
        max-width: 400px;
        /* margin: 0 auto; */
        background-color: #fff;
        /* padding: 20px;
        padding: 20px 3px 20px 10px; */
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        margin-bottom: 15px;
        min-width: 370px;
        position: relative;
        padding-bottom: 20px;
        padding-top: 20px;
        /* background-image: url("https://lh3.googleusercontent.com/u/0/drive-viewer/AKGpihZ7uZz20Mqj53BgikOvObKhBVARcC0h0R-meBGwwnNFI2mhcDjBsz0gGpfIoCVZ0hCeDsOxw_Xt_OWq4WJps0Z8VqBs=w1366-h612");
        background-repeat: no-repeat; */
        /* background-color: rgba(255, 255, 255, 9.9); */
        /* background-position: -60px 135px; */
      }
      .left_3px {
        margin-left: 3px;
      }

      .div_card_info_adicionais {
        /* max-height: 0px;
        overflow: hidden;
        transition: max-height 0.3s ease-in-out; */
        display: none;
      }
      .img_canto {
        height: 5px;
        width: 57px;
        border-radius: 8px; /*8px 0px 0px 8px*/
        position: absolute; /* Para posicionar a imagem corretamente */
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        height: 100%;
        /* width: 100%; */
        /* height: calc(100% - 40px); */
      }
      .esquerda_15 {
        margin-left: 28px;
      }

      .margin_m4px {
        margin-left: -4px;
      }
      .icone_opcoes {
        display: none;
      }
      .div_opcoes_card {
        background: linear-gradient(
          to right,
          #bcdee7,
          #66b7ca,
          #50acc3,
          #0e94b4
        );
        border-radius: 100px 0px 0px 100px;
        background-size: 100% 0%;
        transition: background-size 1s ease;
      }

      /* .div_opcoes_card:hover {
        background-size: 100% 100%;
      } */

      .arrasto {
        background: #51acc3;
        border-radius: 50px 0px 0px 50px;
        padding-top: 10px;
        padding-bottom: 10px;
      }
      .copiar {
        padding-top: 5px;
      }

      .delete {
        padding-bottom: 5px;
      }
      .dropdown {
        position: relative;
        display: inline-block;
        max-width: 230px;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        z-index: 1;
        min-width: 160px;
        padding: 12px;
        overflow-y: auto;
        max-height: 200px;
        max-width: 240px;
      }

      .dropdown-content a {
        color: #002b52;
        text-decoration: none;
        display: block;
        cursor: pointer;
        max-height: 50px;
        width: 240px;
        margin-bottom: 8px;
      }

      .dropdown-content a:hover {
        /* background-color: #bcdfe8; */
        color: #00539e;
      }

      .area_texto {
        overflow-y: hidden; /* Para ocultar a barra de rolagem vertical */
        resize: none; /* Para evitar que o usuário redimensione manualmente */
        border: 1px solid #ccc;
        border-radius: 5px;
        border-color: #57afc5;
        padding: 5px;
        font-family: Arial, sans-serif;
        font-size: medium;
        height: 19px;
        width: 228px;
        color: #002b52;
      }

      .area_texto:focus {
        border-color: #007bff;
        outline: 0;
      }
      .left_55px {
        margin-left: 55px;
      }
      .insere_titulo {
        overflow-y: hidden; /* Para ocultar a barra de rolagem vertical */
        resize: none; /* Para evitar que o usuário redimensione manualmente */
        border: 1px solid #ccc;
        border-radius: 5px;
        /* border-color: #57afc5; */
        padding: 5px;
        font-family: Arial, sans-serif;
        font-size: medium;
        height: 19px;
        width: 228px;
        color: #002b52;
        /* border-color: #007bff; */
        color: black;
        font-weight: bold;
        border: none;
      }
      .insere_titulo:focus {
        /* border-color: #007bff; */
        outline: 0;
      }
      .insere_tipo {
        border: 1px solid #ccc;
        border-radius: 5px;
        border-color: #57afc5;
        padding: 5px;
        font-family: Arial, sans-serif;
        font-size: medium;
        height: 30.6px;
        width: 239.6px;
        color: #002b52;
        border-color: #57afc5;
        /* color: black; */
        /* font-weight: bold; */

        appearance: none; /* Remove a aparência padrão do navegador */
        -webkit-appearance: none;
        -moz-appearance: none;

        cursor: pointer; /* Cursor ao passar por cima */
        background-color: #ffffff;
        margin-bottom: 10px;
      }
      .insere_tipo:focus-visible {
        border-color: #57afc5;
      }
      .insere_tipo:hover {
        border-color: #57afc5;
      }
      .left_50px {
        margin-left: 50px;
      }

      .margin_l-1px {
        margin-left: -1px;
      }
      .color_green {
        color: green;
      }
      .botao_salvar_novo_card {
        background-color: #319857; /* Cor de fundo */
        color: #fff; /* Cor do texto */
        padding: 5px 10px; /* Espaçamento interno */
        font-size: 16px; /* Tamanho da fonte */
        border: none; /* Sem borda */
        border-radius: 5px; /* Borda arredondada */
        cursor: pointer; /* Cursor do mouse */
        transition: background-color 0.3s; /* Transição suave da cor de fundo */
        margin-left: 5px;
      }
      .botao_fechar_novo_card {
        background-color: #af2d16; /* Cor de fundo */
        color: #fff; /* Cor do texto */
        padding: 5px 10px; /* Espaçamento interno */
        font-size: 16px; /* Tamanho da fonte */
        border: none; /* Sem borda */
        border-radius: 5px; /* Borda arredondada */
        cursor: pointer; /* Cursor do mouse */
        transition: background-color 0.3s; /* Transição suave da cor de fundo */
      }
      .div_botoes_salvar_fechar {
        margin-top: 10px;
        /* padding: 5px; */
      }
      .data_hora_anuncio {
        border: 1px solid #ccc;
        border-radius: 5px;
        border-color: #57afc5;
        /* padding: 5px; */
        font-family: Arial, sans-serif;
        font-size: medium;
        height: 30.6px;
        width: 239.6px;
        color: #002b52;
        border-color: #57afc5;
        /* color: black; */
        /* font-weight: bold; */

        appearance: none; /* Remove a aparência padrão do navegador */
        -webkit-appearance: none;
        -moz-appearance: none;

        cursor: pointer; /* Cursor ao passar por cima */
        background-color: #ffffff;
        margin-bottom: 10px;
      }
      .data_hora_card {
        border: 1px solid #ccc;
        border-radius: 5px;
        border-color: #57afc5;
        font-family: Arial, sans-serif;
        font-size: medium;
        /* height: 30.6px; */
        color: #002b52;
        border-color: #57afc5;

        appearance: none; /* Remove a aparência padrão do navegador */
        -webkit-appearance: none;
        -moz-appearance: none;

        cursor: pointer; /* Cursor ao passar por cima */
        background-color: #ffffff;
        border: none;
        outline: none;
      }

      .data_hora_card:focus-visible {
        border: none;
      }
      .diaSemana {
        font-family: Arial, sans-serif;
        font-size: medium;
        height: 30.6px;
        /* width: 239.6px; */
        color: #002b52;
        cursor: pointer; /* Cursor ao passar por cima */
        background-color: #ffffff;
        border: none;
        display: flex;
        margin-left: -5px;
        align-items: center;
        /* font-size: 12px; */
      }
      .caixa_data_hora_card {
        border: 1px solid #ccc;
        border-radius: 5px;
        border-color: #57afc5;
        /* padding: 5px; */
        font-family: Arial, sans-serif;
        font-size: medium;
        height: 30.6px;
        width: 239.6px;
        color: #002b52;
        border-color: #57afc5;
        /* color: black; */
        /* font-weight: bold; */

        appearance: none; /* Remove a aparência padrão do navegador */
        -webkit-appearance: none;
        -moz-appearance: none;

        cursor: pointer; /* Cursor ao passar por cima */
        background-color: #ffffff;
      }
      .tamanho_data_card {
        width: 120px;
        /* width: 75px; */
      }
      .margin-left-1-2px {
        margin-left: -1.2px;
      }
      .icone_opcoes_card_inserir {
        visibility: hidden;
      }
      @media only screen and (max-width: 600px) {
        .tamanho_data_card {
          width: 280px;
        }
        .diaSemana {
          margin-left: -30px;
        }
      }

      #card_padrão {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="">
      <div class="adicionar_elementos">
        <div
          class="flex align justify column"
          style="border: 1px solid #57afc5"
        >
          <h2>Adicionar Elementos</h2>
          <div class="div_card flex align" id="novo_card">
            <img
              draggable="false"
              class="img_canto"
              src="https://lh3.googleusercontent.com/u/0/drive-viewer/AKGpihZ7uZz20Mqj53BgikOvObKhBVARcC0h0R-meBGwwnNFI2mhcDjBsz0gGpfIoCVZ0hCeDsOxw_Xt_OWq4WJps0Z8VqBs=w1366-h612"
              alt=""
            />
            <div class="div_card_info flex column left_50px dropdown">
              <div class="opcoes_novo_card elemento flex row justify align">
                <div class="flex column">
                  <textarea
                    id="nome"
                    class="insere_titulo margin_l-1px"
                    rows="1"
                    spellcheck="false"
                    placeholder="Insira o Título:"
                  ></textarea>
                  <div id="myDropdown" class="dropdown-content"></div>

                  <div class="flex column">
                    <select name="" id="" class="insere_tipo">
                      <option value="texto_livre">Texto livre</option>
                      <option value="data">Data</option>
                      <option value="nomes">Nomes</option>
                      <option value="chamados">Chamados</option>
                      <option value="hinos">Hinos</option>
                    </select>
                  </div>
                </div>
                <span
                  class="material-symbols-outlined"
                  id="deleta_elemento_inserir_card"
                >
                  delete
                </span>
              </div>
              <div
                id="adicionar_elemento"
                class="flex row align justify color_green"
              >
                <span class="material-symbols-outlined"> add </span>
                <p>Adicionar Elemento</p>
              </div>

              <div class="div_card_info_adicionais flex column">
                <!-- <label for="" class="campo_titulo">Tema: </label>
                <input type="text" name="" id="" class="campo_texto" /> -->

                <div
                  class="flex row align justify color_green"
                  id="adicionar_elemento_oculto"
                >
                  <span class="material-symbols-outlined"> add </span>
                  <p>Adicionar Elemento Oculto</p>
                </div>
              </div>
              <div class="div_botoes_salvar_fechar flex row align justify">
                <input
                  class="botao_fechar_novo_card"
                  type="button"
                  value="Fechar"
                />

                <input
                  class="botao_salvar_novo_card"
                  type="button"
                  value="Salvar"
                />
              </div>
            </div>

            <div class="div_opcoes_card flex direita column">
              <span
                class="material-symbols-outlined esquerda_15 icone_opcoes copiar icone_opcoes_card_inserir"
              >
                content_copy
              </span>

              <div class="div_opcoes_meio_card flex align">
                <img
                  class="div_img_icone_whats icone_opcoes icone_opcoes_card_inserir"
                  src="https://www.shareicon.net/data/2048x2048/2016/07/14/607292_black_2048x2048.png"
                  alt=""
                />
                <span class="material-symbols-outlined direita arrasto">
                  drag_indicator
                </span>
              </div>
              <span
                class="material-symbols-outlined esquerda_15 icone_opcoes delete icone_opcoes_card_inserir"
              >
                delete
              </span>
            </div>
          </div>
          <button onclick="captura_dados()">Aoba</button>
        </div>
      </div>

      <div
        class="div_card draggable flex align"
        draggable="true"
        id="card_padrão"
      >
        <img
          draggable="false"
          class="img_canto"
          src="https://lh3.googleusercontent.com/u/0/drive-viewer/AKGpihZ7uZz20Mqj53BgikOvObKhBVARcC0h0R-meBGwwnNFI2mhcDjBsz0gGpfIoCVZ0hCeDsOxw_Xt_OWq4WJps0Z8VqBs=w1366-h612"
          alt=""
        />
        <div class="div_card_info flex column left_55px dropdown">
          <div
            class="div_campos_padrão_novo_card flex row align caixa_data_hora_card"
          >
            <label for="" class="campo_titulo"></label>
            <div
              class="div_novo_card_campo_data flex row align caixa_data_hora_card"
            >
              <input
                type="date"
                name="data"
                id="data"
                class="data_hora_card tamanho_data_card"
                oninput="mostrar_dia_semana_campo_data(this)"
              />
              <div id="diaSemana" class="diaSemana"></div>
              <input
                type="time"
                name="hora"
                id="hora"
                class="data_hora_card margin-left-1-2px"
              />
            </div>
            <div class="div_novo_card_campo_texto">
              <textarea
                id=""
                class="text_area_padrão_novo_card area_texto"
                rows="1"
                spellcheck="false"
              ></textarea>
              <div id="myDropdown" class="dropdown-content"></div>
            </div>
          </div>

          <div class="div_card_info_adicionais flex column"></div>
        </div>

        <div class="div_opcoes_card flex direita column">
          <span
            class="material-symbols-outlined esquerda_15 icone_opcoes copiar"
          >
            content_copy
          </span>

          <div class="div_opcoes_meio_card flex align">
            <img
              class="div_img_icone_whats icone_opcoes"
              src="https://www.shareicon.net/data/2048x2048/2016/07/14/607292_black_2048x2048.png"
              alt=""
            />
            <span class="material-symbols-outlined direita arrasto">
              drag_indicator
            </span>
          </div>
          <span
            class="material-symbols-outlined esquerda_15 icone_opcoes delete"
          >
            delete
          </span>
        </div>
      </div>
      <div class="conteudo_ata flex align justify">
        <div class="" id="area_arrastavel"></div>
      </div>
    </div>
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
    <script>
      // function arrasto() {
      //   $(".draggable").on("dragstart", function (e) {
      //     if ($(this).closest("#area_arrastavel").length === 0) {
      //       return false; // Ignora o arrasto se o elemento não estiver dentro de #area_arrastavel
      //     }
      //     e.originalEvent.dataTransfer.setData("text/plain", e.target.id);

      //     setTimeout(() => {
      //       e.target.classList.add("dragging");
      //     }, 0);
      //   });

      //   $("#area_arrastavel").on("dragover", function (e) {
      //     e.preventDefault();
      //     // const afterElement = getDragAfterElement(
      //     //   $("#area_arrastavel"),
      //     //   event
      //     // );

      //     mouse_em = document.elementFromPoint(event.clientX, event.clientY);
      //     if (mouse_em.id != "area_arrastavel") {
      //       elemento_abaixo = parseInt(mouse_em.closest(".div_card").id) + 1;

      //       elemento_abaixo =
      //         elemento_abaixo > numero_de_cards
      //           ? numero_de_cards
      //           : elemento_abaixo;
      //       afterElement = document.getElementById(elemento_abaixo);
      //     } else {
      //       afterElement = null;
      //     }
      //     console.log(afterElement);
      //     afterElement2 = afterElement;

      //     const draggable = $(".dragging");
      //     if (afterElement == null) {
      //       $("#area_arrastavel").append(draggable);
      //     } else {
      //       $(draggable).insertBefore(afterElement);
      //     }
      //   });

      //   $("#area_arrastavel .draggable").on("drop", function (e) {
      //     e.preventDefault(); // Evita comportamento padrão do navegador
      //     const id = e.originalEvent.dataTransfer.getData("text/plain");
      //     const draggable = $("#" + id);
      //     // const afterElement = getDragAfterElement(
      //     //   $("#area_arrastavel"),
      //     //   event,
      //     //   this
      //     // );

      //     const afterElement = afterElement2;
      //     if (afterElement == null) {
      //       $("#area_arrastavel").append(draggable);
      //     } else {
      //       $(draggable).insertBefore(afterElement);
      //     }
      //     reorganizeIDs();
      //     $(draggable).removeClass("dragging"); // Remover a classe "dragging" após soltar o elemento
      //   });

      //   $(".draggable").on("dragend", function (e) {
      //     $(this).removeClass("dragging"); // Remover a classe "dragging" ao finalizar o arrastar
      //   });
      // }

      // function getDragAfterElement(area_arrastavel, y, currentElement) {
      //   const draggableElements = [
      //     ...$("#area_arrastavel .draggable:not(.dragging)"),
      //   ];
      //   return draggableElements.reduce(
      //     (closest, child) => {
      //       const box = $(child).offset();
      //       const offset = y - box.top - $(child).outerHeight() / 2;
      //       if (
      //         offset < 0 &&
      //         offset > closest.offset &&
      //         child !== currentElement
      //       ) {
      //         return { offset: offset, element: child };
      //       } else if (
      //         offset > 0 &&
      //         offset < closest.offset &&
      //         child !== currentElement
      //       ) {
      //         return { offset: offset, element: child };
      //       } else {
      //         return closest;
      //       }
      //     },
      //     { offset: Number.NEGATIVE_INFINITY }
      //   ).element;
      // }

      // function getDragAfterElement(area_arrastavel, event, currentElement) {
      //   elemento_abaixo =
      //     parseInt(
      //       document
      //         .elementFromPoint(event.clientX, event.clientY)
      //         .closest(".div_card").id
      //     ) + 1;

      //   elemento_abaixo =
      //     elemento_abaixo > numero_de_cards ? numero_de_cards : elemento_abaixo;

      //   elemento_abaixo = document.getElementById("elemento_abaixo");

      //   return elemento_abaixo;
      // }

      function arrasto() {
        document.querySelectorAll(".draggable").forEach(function (element) {
          // Adiciona os listeners de eventos para os eventos de arrastar
          element.addEventListener("dragstart", dragStart);
          element.addEventListener("dragend", dragEnd);
        });

        document
          .querySelectorAll("#area_arrastavel")
          .forEach(function (element) {
            // Adiciona os listeners de eventos para os eventos de soltar
            element.addEventListener("dragenter", dragEnter);
            element.addEventListener("dragover", dragOver);
            element.addEventListener("dragleave", dragLeave);
            element.addEventListener("drop", drop);
          });
      }

      // Função chamada quando o arrasto inicia
      function dragStart(event) {
        console.log(this);
        // event.dataTransfer.setData("text/plain", "Hello");
        // event.originalEvent.dataTransfer.setData("text/plain", this.target.id);
        event.dataTransfer.setData("text/plain", event.target.id);
        // Adiciona uma classe para estilizar o elemento durante o arraste
        this.classList.add("dragging");
      }

      // Função chamada quando o arrasto termina
      function dragEnd() {
        // Remove a classe de estilização
        this.classList.remove("dragging");
      }

      // Função chamada quando o elemento arrastado entra na zona de drop
      function dragEnter(event) {
        event.preventDefault();
        this.classList.add("hovered");
        // console.log("inicio do arrasto");
      }

      // Função chamada quando o elemento arrastado está sobre a zona de drop
      function dragOver(event) {
        event.preventDefault();
        // console.log("area arrastavel");
        // const afterElement = getDragAfterElement(
        //   $("#area_arrastavel"),
        //   event.clientY,
        //   this
        // );
        // console.log(afterElement);
      }

      // Função chamada quando o elemento arrastado sai da zona de drop
      function dragLeave() {
        this.classList.remove("hovered");
        // console.log("Fora da area arrastavel");
      }

      // Função chamada quando o elemento arrastado é solto na zona de drop
      function drop(event) {
        event.preventDefault();
        this.classList.remove("hovered");
        const data = event.dataTransfer.getData("text/plain");
        console.log("soltou");
        // this.innerText = data;

        mouse_em = document.elementFromPoint(event.clientX, event.clientY);
        if (mouse_em.id != "area_arrastavel") {
          elemento_abaixo = parseInt(mouse_em.closest(".div_card").id) + 1;

          elemento_abaixo =
            elemento_abaixo > numero_de_cards
              ? numero_de_cards
              : elemento_abaixo;
          afterElement = document.getElementById(elemento_abaixo);
        } else {
          afterElement = null;
        }

        arrastando = document.querySelector(".dragging");
        document
          .querySelector("#area_arrastavel")
          .insertBefore(arrastando, afterElement);
        console.log(afterElement);
        console.log(arrastando);
      }

      function reorganizeIDs() {
        $("#area_arrastavel .draggable").each(function (index) {
          $(this).attr("id", index + 1);
          numero_de_cards = index + 1;
        });
      }

      function opcoes_card() {
        conteudo_div_selecionada = this.closest(".div_card");

        if (this.id === "" || this.id === "fechada") {
          conteudo_div_selecionada.querySelector(
            ".div_card_info_adicionais"
          ).style.display = "flex";

          conteudo_div_selecionada
            .querySelectorAll(".icone_opcoes")
            .forEach(function (element) {
              element.style.display = "flex";
            });

          conteudo_div_selecionada.querySelector(".arrasto").style.background =
            " #fff";

          conteudo_div_selecionada.querySelector(
            ".div_opcoes_card"
          ).style.backgroundSize = "100% 100%";

          this.id = "aberta";
        } else {
          conteudo_div_selecionada.querySelector(
            ".div_card_info_adicionais"
          ).style.display = "none";

          conteudo_div_selecionada
            .querySelectorAll(".icone_opcoes")
            .forEach(function (element) {
              element.style.display = "none";
            });

          conteudo_div_selecionada.querySelector(
            ".div_opcoes_card"
          ).style.backgroundSize = "100% 0%";

          conteudo_div_selecionada.querySelector(".arrasto").style.background =
            "#51acc3";

          this.id = "fechada";
        }
      }

      var nomes = [
        "Allysson Wyllian Santos Gomes",
        "Julia de Salles Gomes",
        "Cecília de Salles Gomes",
        "David",
        "Eve",
        "Angela Maria Massaneiro dos Santos Cruz",
      ];

      var hinos = [
        "2. Tal Como um Facho",
        "3. Alegres Cantemos",
        "4. No Monte a Bandeira",
        "5. Israel, Jesus Te Chama",
        "9. Graças Damos, Ó Deus, Por um Profeta",
      ];

      function buscar_valores(caixa_texto_id) {
        const input = caixa_texto_id;
        input.style.color = "#002b52";
        const filter = input.value.toLowerCase();
        const dropdown =
          caixa_texto_id.parentElement.querySelector(".dropdown-content");
        dropdown.innerHTML = "";
        texto_digitado_invalido = true;

        dropdown.style.display = "block"; //comentar na opção 1
        valores = [];
        if (input.id === "nomes") {
          valores = nomes;
        } else if (input.id === "hinos") {
          valores = hinos;
        } else if (input.id === "chamados") {
          valores = chamados;
        }

        valores.forEach((valor) => {
          if (valor.toLowerCase().includes(filter)) {
            input.style.color = "#002b52";
            const nameElement = document.createElement("a");
            nameElement.textContent = valor;
            nameElement.onclick = function () {
              input.value = valor;
              dropdown.style.display = "none";
              ajusta_altura_area_texto(caixa_texto_id);
            };
            dropdown.appendChild(nameElement);

            texto_digitado_invalido = false;

            // teste = `<a>Angela Maria Massaneiro dos Santos Cruz</a>
            // <a>Feminino</a>
            // <a>50anos</a>`;
            // dropdown.innerHTML = teste;
          }
        });
        if (texto_digitado_invalido && filter !== "" && valores.length != 0) {
          input.style.color = "#9a0909";
          dropdown.style.display = "none";
          dropdown.innerHTML = "";
        }

        // if (texto_digitado_invalido && filter !== "") {
        //   input.style.color = "red";
        //   const texto_digitado_invalidoElement = document.createElement("a");
        //   texto_digitado_invalidoElement.textContent = input.value;
        //   texto_digitado_invalidoElement.style.color = "red";
        //   texto_digitado_invalidoElement.onclick = function () {
        //     input.value = this.textContent;
        //     dropdown.style.display = "none";
        //   };
        //   dropdown.appendChild(texto_digitado_invalidoElement);
        // }

        if (filter === "" || valores.length === 0) {
          dropdown.style.display = "none";
        } else {
          // dropdown.style.display = "block";
        }
      }

      // // Fechar dropdown e limpar input quando clicar fora do dropdown
      window.addEventListener("click", function (event) {
        if (
          !event.target.matches(".dropdown") &&
          !event.target.matches(".dropdown a") &&
          !event.target.matches(".area_texto")
        ) {
          // document.getElementById("myDropdown").style.display = "none";
          document
            .querySelectorAll(".dropdown-content")
            .forEach(function (element) {
              if (
                element.style.display != "none" &&
                element.style.display != ""
              ) {
                element.style.display = "none";
                if (!valor_texto) {
                  element.parentElement.querySelector(
                    ".area_texto"
                  ).style.color = "#9a0909";
                }
              }

              // document.getElementById("searchInput").style.color = "#9a0909";
              // element.parentElement.querySelector("area_texto").style.color =
              //   "#9a0909";
            });
        }
      });

      function ajusta_altura_area_texto(caixa_texto_id) {
        valor_texto = false;
        if (event.type === "click") {
          //clicou
          area_texto = caixa_texto_id;
          valor_texto = true;
        } else {
          //digitou
          area_texto = this;
        }

        area_texto.style.height = "19px";
        area_texto.style.height = area_texto.scrollHeight - 10 + "px";

        conteudo_div_selecionada = area_texto.closest(".div_card");

        conteudo_div_selecionada.querySelector(".img_canto").style.height =
          "100%";

        if (event.type === "input") {
          caixa_texto_id = area_texto;
          buscar_valores(caixa_texto_id);
        }
      }

      // Criar o HTML dos elementos que você deseja adicionar
      opcoes_novo_card_clone = document
        .querySelector(".opcoes_novo_card")
        .cloneNode(true);

      function adicionarElemento(divInfoAdicionais, elementoReferencia) {
        opcoes_novo_card = opcoes_novo_card_clone.cloneNode(true);
        opcoes_novo_card.querySelector("#nome").value = "";
        // Inserir o novo elemento antes do elemento de referência
        divInfoAdicionais.insertBefore(opcoes_novo_card, elementoReferencia);
        atualiza_ouvintes();
      }

      document
        .querySelector("#adicionar_elemento_oculto")
        .addEventListener("click", function () {
          var divInfoAdicionais = this.closest(".div_card").querySelector(
            ".div_card_info_adicionais"
          );
          var elementoReferencia = this;
          adicionarElemento(divInfoAdicionais, elementoReferencia);
        });

      // document.querySelector(".opcoes_novo_card").closest(".div_card");

      document
        .querySelector("#adicionar_elemento")
        .addEventListener("click", function () {
          var divInfoAdicionais =
            this.closest(".div_card").querySelector(".div_card_info");
          var elementoReferencia = this;
          adicionarElemento(divInfoAdicionais, elementoReferencia);
        });

      function excluir_elemento_form_criacao() {
        this.closest(".elemento").remove();
      }

      function atualiza_ouvintes() {
        document
          .querySelectorAll("#deleta_elemento_inserir_card")
          .forEach(function (element) {
            element.addEventListener("click", excluir_elemento_form_criacao);
          });

        document.querySelectorAll(".arrasto").forEach(function (element) {
          element.addEventListener("click", opcoes_card);
        });

        document.querySelectorAll(".area_texto").forEach(function (element) {
          element.addEventListener("input", ajusta_altura_area_texto);
          element.addEventListener("onload", ajusta_altura_area_texto);
        });

        document.querySelectorAll(".delete").forEach(function (element) {
          element.addEventListener("click", deletar_card);
        });
        arrasto();
        // $(".arrasto").on("click", opcoes_card);
        insere_hora_campo_data_vazio();
      }
      atualiza_ouvintes();

      function mostrar_dia_semana_campo_data(element) {
        var diasSemana = [
          "Domingo",
          "Seg.feira",
          "Ter.feira",
          "Qua.feira",
          "Qui.feira",
          "Sex.feira",
          "Sábado",
        ];

        element.parentElement.querySelector("#diaSemana").textContent =
          diasSemana[new Date(element.value + "T" + "00:00").getDay()];
      }

      insere_hora_campo_data_vazio();
      function insere_hora_campo_data_vazio() {
        document.querySelectorAll("#data").forEach(function (element) {
          if (element.value === "") {
            element.valueAsDate = new Date();
            mostrar_dia_semana_campo_data(element);

            var dataAtual = new Date();

            var horaAtual = dataAtual.getHours();

            dataAtual.setMinutes(0);

            var horaFormatada = dataAtual.toLocaleTimeString([], {
              hour: "2-digit",
              minute: "2-digit",
            });

            element.parentElement.querySelector("#hora").value = horaFormatada;
          }
        });
      }

      function atualiza_data_campo(element) {
        if (element.value === "") {
          element.valueAsDate = new Date();
        }
      }

      document
        .querySelector(".botao_salvar_novo_card")
        .addEventListener("click", salvar_novo_card);

      cards = [
        {
          card: 1,
          posicao_no_card: 1,
          label: "Anúncio:",
          tipo: "texto_livre",
          elemento_oculto: 0,
          value: "Teste Titulo Anuncio",
        },
        {
          card: 1,
          posicao_no_card: 2,
          label: "Data:",
          tipo: "data",
          elemento_oculto: 0,
          value: "2024-03-12T19:00",
        },
        {
          card: 1,
          posicao_no_card: 3,
          label: "Local",
          tipo: "texto_livre",
          elemento_oculto: 0,
        },
        {
          card: 1,
          posicao_no_card: 1,
          label: "Observações:",
          tipo: "texto_livre",
          elemento_oculto: 1,
        },
        {
          card: 2,
          posicao_no_card: 1,
          label: "Hino de Abertura:",
          tipo: "hinos",
          elemento_oculto: 0,
          value: "9. Graças Damos, Ó Deus, Por um Profeta",
        },
        {
          card: 3,
          posicao_no_card: 1,
          label: "Oração:",
          tipo: "nomes",
          elemento_oculto: 0,
          value: "Angela Maria Massaneiro dos Santos Cruz",
        },
        {
          card: 3,
          posicao_no_card: 2,
          label: "Teste Oculto:",
          tipo: "nomes",
          elemento_oculto: 1,
        },
      ];

      function salvar_novo_card() {
        cards = [];
        document
          .querySelector("#novo_card")
          .querySelectorAll("select")
          .forEach(function (element) {
            if (element.type === "select-one") {
              //identifica se o elemento é oculto
              if (element.closest(".div_card_info_adicionais")) {
                elemento_oculto = 1;
              } else {
                elemento_oculto = 0;
              }

              cards.push({
                card: 1,
                posicao_no_card: null,
                label:
                  element.parentElement.parentElement.querySelector("#nome")
                    .value,
                tipo: element.value,
                elemento_oculto: elemento_oculto,
              });
            }
          });
        carrega_dados();
        fechar_tela_novo_card();
      }

      $(".botao_fechar_novo_card").on("click", carrega_dados);
      function fechar_tela_novo_card() {
        $(".opcoes_novo_card").remove();
        $("#adicionar_elemento").click();
      }
      function deletar_card() {
        this.closest(".div_card").remove();
      }

      function separar_array() {
        // Objeto para armazenar os cards agrupados
        cardsAgrupados = {};

        // Iterando sobre o array de dados
        cards.forEach((item) => {
          // Verificando se o card já existe no objeto de cards agrupados
          if (!cardsAgrupados[item.card]) {
            // Se não existe, criamos um novo array para esse card
            cardsAgrupados[item.card] = [];
          }
          // Adicionamos o item atual ao array correspondente ao seu card
          cardsAgrupados[item.card].push(item);
        });
      }

      function carrega_dados() {
        separar_array();

        // Agora, vamos renderizar os cards
        for (const card in cardsAgrupados) {
          if (Object.hasOwnProperty.call(cardsAgrupados, card)) {
            //clona o card padrão
            card_novo = document.querySelector("#card_padrão").cloneNode(true);

            //insere o card clone criado na área arrastável
            document.querySelector("#area_arrastavel").appendChild(card_novo);

            //cria uma referência para inserir os elementos visiveis
            referencia = card_novo.querySelector(".div_card_info_adicionais");

            //atualiza o id do novo card criado
            novo_id = 99;
            card_novo.id = novo_id;
            cardsAgrupados[card].forEach((element) => {
              //clona a etiqueta
              campo_label = card_novo
                .querySelector(".campo_titulo")
                .cloneNode(true);

              //clona o campo de data
              campo_data = card_novo
                .querySelector(".div_novo_card_campo_data")
                .cloneNode(true);

              //clona o campo de texto
              campo_texto = card_novo
                .querySelector(".div_novo_card_campo_texto")
                .cloneNode(true);

              //captura a etiqueta
              campo_label.textContent = element.label;

              //Captura o campo que sera inserido
              if (element.tipo === "data") {
                //Se a data tem valor predefinido Insere o valor da data
                element.value
                  ? (campo_data.querySelector("#data").value =
                      element.value.substr(0, 10))
                  : "";

                //Se a hora tem valor predefinido Insere o valor da hora
                element.value
                  ? (campo_data.querySelector("#hora").value =
                      element.value.substr(11, 5))
                  : "";

                tipo_de_campo = campo_data;
              } else {
                campo_texto.querySelector(".text_area_padrão_novo_card").id =
                  element.tipo;

                element.value
                  ? (campo_texto.querySelector("#" + element.tipo).value =
                      element.value)
                  : "";

                tipo_de_campo = campo_texto;
              }

              //cria uma div e insere os elemento
              campo_card_com_label = document.createElement("div");
              campo_card_com_label.id = "campo_card_com_label";
              campo_card_com_label.appendChild(campo_label);
              campo_card_com_label.appendChild(tipo_de_campo);

              //insere os elementos na div (caso seja oculta insere na div oculta).
              if (element.elemento_oculto === 1) {
                div_card_info_adicionais = card_novo
                  .querySelector(".div_card_info")
                  .querySelector(".div_card_info_adicionais");
                div_card_info_adicionais.appendChild(campo_card_com_label);
              } else {
                div_card_info = card_novo.querySelector(".div_card_info");
                div_card_info.insertBefore(campo_card_com_label, referencia);
              }

              //ajusta altura dos elementos de texto
              area_texto = campo_texto.querySelector(".area_texto");
              area_texto.style.height = "19px";
              area_texto.style.height = area_texto.scrollHeight - 10 + "px";

              //torna o novo card visivel
              card_novo.style.display = "flex";

              //atualiza os ouvintes para ativar a funcionalidade dos botões do novo card
              atualiza_ouvintes();

              fechar_tela_novo_card();
            });
            //remove os campos padrão do card clonado
            card_novo.querySelector(".div_campos_padrão_novo_card").remove();
          }
        }
        reorganizeIDs();
      }

      function captura_dados() {
        carrega_dados();
        capturados = [];
        aqui = document
          .querySelector("#area_arrastavel")
          .querySelectorAll("#campo_card_com_label"); //$('#area_arrastavel')

        aqui.forEach(function (element) {
          tipo = element.querySelector("textarea, input[type=date]").id;
          if (tipo === "data") {
            value =
              element.querySelector(" input[type=date]").value +
              "T" +
              element.querySelector(" input[type=time]").value;
          } else {
            value = element.querySelector("textarea").value;
          }
          if (element.closest(".div_card_info_adicionais")) {
            elemento_oculto = 1;
          } else {
            elemento_oculto = 0;
          }

          capturados.push({
            card: element.closest(".div_card").id,
            posicao_no_card: null,
            label: element.querySelector("label").textContent,
            tipo: tipo,
            elemento_oculto: elemento_oculto,
            value: value,
          });
        });
        console.log(capturados);
        carrega_dados();
      }

      captura_dados();
    </script>
  </body>
</html>
