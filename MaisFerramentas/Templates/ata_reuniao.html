<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Divs Arrastáveis</title>
    <style>
      /* .draggable {
        border: 1px solid #ccc;
        padding: 10px;
        margin-bottom: 5px;
        /* cursor: move; 
      } */

      .dragging {
        opacity: 0.5;
      }

      .flex {
        display: flex;
      }
      .column {
        flex-direction: column;
      }
      .row {
        flex-direction: row;
      }
      .tamanho {
        width: 360px;
      }
      .div_img_icone {
        display: flex;
        border-radius: 50px;
        width: 50px;
        height: 50px;
        border: 1px solid black;
        background-image: url("https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSUb-j_tc0tQGYF8zBywQ2MXUFuh0PoqNWUL4qu8lTShtqo7IhFRBZhOlVmM1dKN0ospPs&usqp=CAU");
        background-size: 62px;
        background-repeat: no-repeat;
        background-position: -6px 4px;
        margin-right: 8px;
        /* background-color: rgba(255, 255, 255, 9.9); */
      }
      .div_img_icone_2 {
        display: flex;
        border-radius: 50px;
        width: 40px;
        height: 40px;
        border: 1px solid black;
        background-image: url("https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSUb-j_tc0tQGYF8zBywQ2MXUFuh0PoqNWUL4qu8lTShtqo7IhFRBZhOlVmM1dKN0ospPs&usqp=CAU");
        background-size: 50px;
        background-repeat: no-repeat;
        background-position: -5px 4px;
        margin-right: 8px;
        /* background-color: rgba(255, 255, 255, 9.9); */
      }

      .div_img_icone_whats {
        display: flex;
        border-radius: 50px;
        width: 31px;
        height: 31px;
        margin-right: -10px;
        margin-left: 3px;
        margin-top: -4px;
      }
      .justify {
        justify-content: center;
      }
      .align {
        align-items: center;
      }
      .direita {
        margin-left: auto;
      }
      #area_arrastavel {
        min-height: 100px; /* altura mínima para permitir arrastar até o final */
        margin-top: 30px;
      }

      .img_icones {
        display: flex;
        border-radius: 50px;
        width: 60px;
        height: 60px;
        margin-left: -23px;
      }

      .campo_texto {
        width: 100%;
        padding: 5px;
        border: 1px solid #ccc;
        border-radius: 5px;
        border-color: #57afc5;
        font-size: medium;
        /* -webkit-text-fill-color: #002344; */
        /* width: 17rem; */
      }

      .campo_texto:focus {
        outline: none;
        border-color: #007bff;
      }
      .campo_titulo {
        font-weight: bold;
      }
      .div_card {
        max-width: 400px;
        /* margin: 0 auto; */
        background-color: #fff;
        /* padding: 20px;
        padding: 20px 3px 20px 10px; */
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        margin-bottom: 15px;
        min-width: 370px;
        position: relative;
        padding-bottom: 20px;
        padding-top: 20px;
        /* background-image: url("https://lh3.googleusercontent.com/u/0/drive-viewer/AKGpihashdFwspuu_FFEENE5OwOA-hx1cpncY9jAG_VEu-iS9HkknAl29yXZOiRLgpjwCeOyTjzNk5HkOHN_MUNoEl5etYofGqH-Hg=w1366-h612");
        background-repeat: no-repeat; */
        /* background-color: rgba(255, 255, 255, 9.9); */
        /* background-position: -60px 135px; */
      }
      .left_3px {
        margin-left: 3px;
      }

      .div_card_info_adicionais {
        /* max-height: 0px;
        overflow: hidden;
        transition: max-height 0.3s ease-in-out; */
        display: none;
      }
      .img_canto {
        height: 5px;
        width: 57px;
        border-radius: 8px; /*8px 0px 0px 8px*/
        position: absolute; /* Para posicionar a imagem corretamente */
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        height: 100%;
        /* width: 100%; */
        /* height: calc(100% - 40px); */
      }
      .esquerda_15 {
        margin-left: 28px;
      }

      .margin_m4px {
        margin-left: -4px;
      }
      .icone_opcoes {
        display: none;
      }
      .div_opcoes_card {
        background: linear-gradient(
          to right,
          #bcdee7,
          #66b7ca,
          #50acc3,
          #0e94b4
        );
        border-radius: 100px 0px 0px 100px;
        background-size: 100% 0%;
        /* transition: background-size 1s ease; */
      }

      /* .div_opcoes_card:hover {
        background-size: 100% 100%;
      } */

      .arrasto {
        background: #51acc3;
        border-radius: 50px 0px 0px 50px;
        padding-top: 10px;
        padding-bottom: 10px;
      }
      .copiar {
        padding-top: 5px;
      }

      .delete {
        padding-bottom: 5px;
      }
      .dropdown {
        position: relative;
        display: inline-block;
        max-width: 230px;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
        z-index: 1;
        min-width: 160px;
        padding: 12px;
        overflow-y: auto;
        max-height: 200px;
        max-width: 240px;
      }

      .dropdown-content a {
        color: #002b52;
        text-decoration: none;
        display: block;
        cursor: pointer;
        max-height: 50px;
        width: 240px;
        margin-bottom: 8px;
      }

      .dropdown-content a:hover {
        /* background-color: #bcdfe8; */
        color: #00539e;
      }

      .area_texto {
        overflow-y: hidden; /* Para ocultar a barra de rolagem vertical */
        resize: none; /* Para evitar que o usuário redimensione manualmente */
        border: 1px solid #ccc;
        border-radius: 5px;
        border-color: #57afc5;
        padding: 5px;
        font-family: Arial, sans-serif;
        font-size: medium;
        height: 19px;
        width: 228px;
        color: #002b52;
      }

      .area_texto:focus {
        border-color: #007bff;
        outline: 0;
      }
      .left_55px {
        margin-left: 55px;
      }
      .insere_titulo {
        overflow-y: hidden; /* Para ocultar a barra de rolagem vertical */
        resize: none; /* Para evitar que o usuário redimensione manualmente */
        border: 1px solid #ccc;
        border-radius: 5px;
        /* border-color: #57afc5; */
        padding: 5px;
        font-family: Arial, sans-serif;
        font-size: medium;
        height: 19px;
        width: 228px;
        color: #002b52;
        /* border-color: #007bff; */
        color: black;
        font-weight: bold;
        border: none;
      }
      .insere_titulo:focus {
        /* border-color: #007bff; */
        outline: 0;
      }
      .insere_tipo {
        border: 1px solid #ccc;
        border-radius: 5px;
        border-color: #57afc5;
        padding: 5px;
        font-family: Arial, sans-serif;
        font-size: medium;
        height: 30.6px;
        width: 239.6px;
        color: #002b52;
        border-color: #57afc5;
        /* color: black; */
        /* font-weight: bold; */

        appearance: none; /* Remove a aparência padrão do navegador */
        -webkit-appearance: none;
        -moz-appearance: none;

        cursor: pointer; /* Cursor ao passar por cima */
        background-color: #ffffff;
        margin-bottom: 10px;
      }
      .insere_tipo:focus-visible {
        border-color: #57afc5;
      }
      .insere_tipo:hover {
        border-color: #57afc5;
      }
      .left_50px {
        margin-left: 50px;
      }

      .margin_l-1px {
        margin-left: -1px;
      }
      .color_green {
        color: green;
      }
      .botao_salvar_novo_card {
        background-color: #319857; /* Cor de fundo */
        color: #fff; /* Cor do texto */
        padding: 5px 10px; /* Espaçamento interno */
        font-size: 16px; /* Tamanho da fonte */
        border: none; /* Sem borda */
        border-radius: 5px; /* Borda arredondada */
        cursor: pointer; /* Cursor do mouse */
        transition: background-color 0.3s; /* Transição suave da cor de fundo */
        margin-left: 5px;
      }
      .botao_fechar_novo_card {
        background-color: #af2d16; /* Cor de fundo */
        color: #fff; /* Cor do texto */
        padding: 5px 10px; /* Espaçamento interno */
        font-size: 16px; /* Tamanho da fonte */
        border: none; /* Sem borda */
        border-radius: 5px; /* Borda arredondada */
        cursor: pointer; /* Cursor do mouse */
        transition: background-color 0.3s; /* Transição suave da cor de fundo */
      }
      .div_botoes_salvar_fechar {
        margin-top: 10px;
        /* padding: 5px; */
      }
      .data_hora_anuncio {
        border: 1px solid #ccc;
        border-radius: 5px;
        border-color: #57afc5;
        /* padding: 5px; */
        font-family: Arial, sans-serif;
        font-size: medium;
        height: 30.6px;
        width: 239.6px;
        color: #002b52;
        border-color: #57afc5;
        /* color: black; */
        /* font-weight: bold; */

        appearance: none; /* Remove a aparência padrão do navegador */
        -webkit-appearance: none;
        -moz-appearance: none;

        cursor: pointer; /* Cursor ao passar por cima */
        background-color: #ffffff;
        margin-bottom: 10px;
      }
      .data_hora_card {
        border: 1px solid #ccc;
        border-radius: 5px;
        border-color: #57afc5;
        font-family: Arial, sans-serif;
        font-size: medium;
        /* height: 30.6px; */
        color: #002b52;
        border-color: #57afc5;

        appearance: none; /* Remove a aparência padrão do navegador */
        -webkit-appearance: none;
        -moz-appearance: none;

        cursor: pointer; /* Cursor ao passar por cima */
        background-color: #ffffff;
        border: none;
        outline: none;
      }

      .data_hora_card:focus-visible {
        border: none;
      }
      .diaSemana {
        font-family: Arial, sans-serif;
        font-size: medium;
        height: 30.6px;
        /* width: 239.6px; */
        color: #002b52;
        cursor: pointer; /* Cursor ao passar por cima */
        background-color: #ffffff;
        border: none;
        display: flex;
        margin-left: -5px;
        align-items: center;
        /* font-size: 12px; */
      }
      .caixa_data_hora_card {
        border: 1px solid #ccc;
        border-radius: 5px;
        border-color: #57afc5;
        /* padding: 5px; */
        font-family: Arial, sans-serif;
        font-size: medium;
        height: 30.6px;
        width: 239.6px;
        color: #002b52;
        border-color: #57afc5;
        /* color: black; */
        /* font-weight: bold; */

        appearance: none; /* Remove a aparência padrão do navegador */
        -webkit-appearance: none;
        -moz-appearance: none;

        cursor: pointer; /* Cursor ao passar por cima */
        background-color: #ffffff;
      }
      .tamanho_data_card {
        width: 120px;
        /* width: 75px; */
      }
      .margin-left-1-2px {
        margin-left: -1.2px;
      }
      .icone_opcoes_card_inserir {
        visibility: hidden;
      }
      @media only screen and (max-width: 600px) {
        .tamanho_data_card {
          width: 280px;
        }
        .diaSemana {
          margin-left: -30px;
        }
      }

      #card_padrão {
        display: none;
      }
      .clonar {
        margin-left: 8px;
      }

      .titulo_card_criar_adicionar_novo_card {
        font-weight: bold;
        margin: 0;
        margin-bottom: 10px;
      }

      .margins {
        margin: 0;
      }
      #novo_card {
        display: none;
        /*height: 150px;*/
        margin-top: 70px;
        margin-left: 18px;
        height: fit-content;
      }
      #adicionar_card_existente {
        display: none;
        height: fit-content;
        margin-top: 70px;
        margin-left: 18px;
      }

      .div_botao_adicionar_elemento_pronto {
        margin-top: 15px;
        color: green;
        display: flex;
        /* flex-direction: column;  */
        align-items: center;
      }
      .cobertura_content {
        background-color: rgba(0, 0, 0, 0.4);
        position: fixed;
        inset: 0px 0px 0px -18px;
        z-index: 1;
        display: flex;
        display: none;
        position: absolute;
        justify-content: center;
      }
      #funcoes_gerais_da_ata {
        margin-top: 15px;
        color: #003057;
        display: flex;
        flex-direction: column;
        align-items: center;
      }
      /* .img_whatsapp_funcoes_gerais_ata{
        background-color: #0dc143;
      } */
      /* #etiqueta_enviar_ata_via_whats{
        margin-left: 10px;
      } */
      .botoes_de_adicao {
        display: flex;
        align-items: center;
        border: #319857 1px solid;
        border-radius: 10px 10px 10px 10px;
        justify-content: center;
        background-color: #319857;
        font-size: large;
        border: 2px solid #319857;
        background-color: transparent;
        color: #319857;
        padding: 5px 10px;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
        margin-bottom: 10px;
      }
      .div_de_uma_funcao_geral_da_ata{
        margin-bottom: 10px;
      }

      
      .botaoSalvar {
          position: fixed;
          bottom: 20px;
          right: 20px;
          padding: 10px 10px;
          background-color: #319857;
          color: #fff;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.3);
          z-index: 2;
          display: flex;
          align-items: center;
          justify-content: center;
          border-radius: 50%;
          width: 40px;
          height: 40px;
      }

      /* .botaoSalvar:hover {
          background-color: #0056b3;
      } */

      .botao_usar_ata_padrao{
        display: flex;
        align-items: center;
        border: #003057 1px solid;
        border-radius: 10px 10px 10px 10px;
        justify-content: center;
        background-color: #003057;
        font-size: large;
        border: 2px solid #003057;
        background-color: transparent;
        color: #003057;
        padding: 5px 10px;
        cursor: pointer;
        transition: background-color 0.3s, color 0.3s;
        margin-bottom: 10px;
      }
    </style>
  </head>
  <body>
    <!-- <div  id="botaoSalvar" class="botaoSalvar">
      <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="35px" fill="#fff"><path d="M840-683v503q0 24-18 42t-42 18H180q-24 0-42-18t-18-42v-600q0-24 18-42t42-18h503l157 157Zm-60 27L656-780H180v600h600v-476ZM479.76-245q43.24 0 73.74-30.26 30.5-30.27 30.5-73.5 0-43.24-30.26-73.74-30.27-30.5-73.5-30.5-43.24 0-73.74 30.26-30.5 30.27-30.5 73.5 0 43.24 30.26 73.74 30.27 30.5 73.5 30.5ZM233-584h358v-143H233v143Zm-53-72v476-600 124Z"/></svg>
    </div> -->
    <div class="" id="conteudo">
      <!-- <div class="flex column">
        <button onclick="copiar_texto_completo_da_ata()">
          copiar_texto_completo_da_ata
        </button>
        <button onclick="enviar_texto_completo_da_ata_via_whatsapp()">
          enviar_texto_completo_da_ata_via_whatsapp
        </button>
      </div> -->
      <div class="cobertura_content"></div>
      <div class="flex column justify align" id="funcoes_gerais_da_ata">


        <!-- <div class="flex botao_usar_ata_padrao" id="botao_usar_ata_padrao">
          <span class="material-symbols-outlined">
            list_alt
          </span>
          Usar modelo de ata padrão
        </div> -->

        <div class="flex align justify div_de_uma_funcao_geral_da_ata" id="botao_usar_ata_padrao">
          <span class="material-symbols-outlined" style="margin-right: 5px">
            list_alt
          </span>
          <label for="">Usar modelo de ata padrão</label>
        </div>
        
        <div class="flex align justify div_de_uma_funcao_geral_da_ata" id="enviar_texto_completo_da_ata_via_whatsapp" >
          <!-- <img class="div_img_icone_whats icone_opcoes img_whatsapp_funcoes_gerais_ata" src="https://www.shareicon.net/data/2048x2048/2016/07/14/607292_black_2048x2048.png" alt="" style="display: flex;"> -->
          <span class="material-symbols-outlined"
          style="margin-right: 5px">
          send
          </span>
          <label for="" id="etiqueta_enviar_ata_via_whats" 
          >Enviar Ata via Whatsapp</label>
        </div>
        
        
        <div class="flex align justify div_de_uma_funcao_geral_da_ata" id="copiar_texto_completo_da_ata">
          <span class="material-symbols-outlined" style="margin-right: 5px">
            content_copy
          </span>
          <label for="">Copiar conteúdo da Ata</label>
        </div>

        
        <!-- <div class="flex align justify div_de_uma_funcao_geral_da_ata" >
          <span class="material-symbols-outlined" style="margin-right: 5px">
            print
          </span>
          <label for="">Imprimir Ata</label>
        </div> -->


        
      </div>
      <div
        class="div_botao_adicionar_elemento_pronto flex align justify column"
      >
        <div class="flex botoes_de_adicao" id="botao_adicionar_card_pronto">
          <span class="material-symbols-outlined"> add </span>
          Adicionar Card Pronto
        </div>
        <div class="flex botoes_de_adicao" id="botao_criar_card_novo">
          <span class="material-symbols-outlined"> add </span>
          Criar Card Novo
        </div>
      </div>

      <div class="adicionar_elementos">
        <div class="flex align justify column">
          <div class="div_card flex align" id="novo_card">
            <img
              draggable="false"
              class="img_canto"
              src="https://lh3.googleusercontent.com/u/0/drive-viewer/AKGpihashdFwspuu_FFEENE5OwOA-hx1cpncY9jAG_VEu-iS9HkknAl29yXZOiRLgpjwCeOyTjzNk5HkOHN_MUNoEl5etYofGqH-Hg=w1366-h612"
              alt=""
            />
            <div class="div_card_info flex column left_50px dropdown">
              <p class="titulo_card_criar_adicionar_novo_card">Criar CARD</p>
              <div class="opcoes_novo_card elemento flex row align">
                <div class="flex column">
                  <textarea
                    id="nome"
                    class="insere_titulo margin_l-1px"
                    rows="1"
                    spellcheck="false"
                    placeholder="Insira o Título:"
                  ></textarea>
                  <div id="myDropdown" class="dropdown-content"></div>

                  <div class="flex column">
                    <select name="" id="" class="insere_tipo">
                      <option value="texto_livre">Texto livre</option>
                      <option value="data">Data</option>
                      <option value="nomes">Nomes</option>
                      <option value="chamados">Chamados</option>
                      <option value="hinos">Hinos</option>
                    </select>
                  </div>
                </div>
                <span
                  class="material-symbols-outlined"
                  id="deleta_elemento_inserir_card"
                >
                  delete
                </span>
              </div>
              <div
                id="adicionar_elemento"
                class="flex row align justify color_green"
              >
                <span class="material-symbols-outlined"> add </span>
                <p class="margins">Adicionar Elemento</p>
              </div>

              <div class="div_card_info_adicionais flex column">
                <!-- <label for="" class="campo_titulo">Tema: </label>
                <input type="text" name="" id="" class="campo_texto" /> -->

                <div
                  class="flex row align justify color_green"
                  id="adicionar_elemento_oculto"
                >
                  <span class="material-symbols-outlined"> add </span>
                  <p>Adicionar Elemento Oculto</p>
                </div>
              </div>
              <div class="div_botoes_salvar_fechar flex row align justify">
                <input
                  class="botao_fechar_novo_card"
                  type="button"
                  value="Fechar"
                />

                <input
                  class="botao_salvar_novo_card"
                  id="botao_salvar_novo_card"
                  type="button"
                  value="Salvar"
                />
              </div>
            </div>

            <div class="div_opcoes_card flex direita column">
              <span
                class="material-symbols-outlined esquerda_15 icone_opcoes copiar icone_opcoes_card_inserir"
              >
                content_copy
              </span>

              <div class="div_opcoes_meio_card flex align">
                <img
                  class="div_img_icone_whats icone_opcoes icone_opcoes_card_inserir"
                  src="https://www.shareicon.net/data/2048x2048/2016/07/14/607292_black_2048x2048.png"
                  alt=""
                />
                <span class="material-symbols-outlined direita arrasto">
                  drag_indicator
                </span>
              </div>
              <span
                class="material-symbols-outlined esquerda_15 icone_opcoes delete icone_opcoes_card_inserir"
              >
                delete
              </span>
            </div>
          </div>

          <div class="div_card flex align" id="adicionar_card_existente">
            <img
              draggable="false"
              class="img_canto"
              src="https://lh3.googleusercontent.com/u/0/drive-viewer/AKGpihashdFwspuu_FFEENE5OwOA-hx1cpncY9jAG_VEu-iS9HkknAl29yXZOiRLgpjwCeOyTjzNk5HkOHN_MUNoEl5etYofGqH-Hg=w1366-h612"
              alt=""
            />
            <div class="div_card_info flex column left_50px dropdown">
              <p class="titulo_card_criar_adicionar_novo_card">
                Adicionar CARD
              </p>
              <div class="flex column">
                <select
                  name=""
                  id="insere_novo_card_pronto"
                  class="insere_tipo insere_novo_card_pronto"
                ></select>
              </div>

              <div class="div_botoes_salvar_fechar flex row align justify">
                <input
                  class="botao_fechar_novo_card"
                  type="button"
                  value="Fechar"
                />

                <input
                  id="salvar_adicionar_card_pronto"
                  class="botao_salvar_novo_card"
                  type="button"
                  value="Salvar"
                />
              </div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="div_card draggable flex align"
        draggable="true"
        id="card_padrão"
      >
        <img
          draggable="false"
          class="img_canto"
          src="https://lh3.googleusercontent.com/u/0/drive-viewer/AKGpihashdFwspuu_FFEENE5OwOA-hx1cpncY9jAG_VEu-iS9HkknAl29yXZOiRLgpjwCeOyTjzNk5HkOHN_MUNoEl5etYofGqH-Hg=w1366-h612"
          alt=""
        />
        <div class="div_card_info flex column left_55px dropdown">
          <div
            class="div_campos_padrão_novo_card flex row align caixa_data_hora_card"
          >
            <label for="" class="campo_titulo"></label>
            <div
              class="div_novo_card_campo_data flex row align caixa_data_hora_card"
            >
              <input
                type="date"
                name="data"
                id="data"
                class="data_hora_card tamanho_data_card"
                oninput="mostrar_dia_semana_campo_data(this)"
              />
              <div id="diaSemana" class="diaSemana"></div>
              <input
                type="time"
                name="hora"
                id="hora"
                class="data_hora_card margin-left-1-2px"
              />
            </div>
            <div class="div_novo_card_campo_texto">
              <textarea
                id=""
                class="text_area_padrão_novo_card area_texto"
                rows="1"
                spellcheck="false"
              ></textarea>
              <div id="myDropdown" class="dropdown-content"></div>
            </div>
          </div>

          <div class="div_card_info_adicionais flex column"></div>
        </div>

        <div class="div_opcoes_card flex direita column">
          <span
            class="material-symbols-outlined esquerda_15 icone_opcoes copiar"
          >
            content_copy
          </span>

          <div class="div_opcoes_meio_card flex align">
            <div class="flex column">
              <img
                class="div_img_icone_whats icone_opcoes"
                src="https://www.shareicon.net/data/2048x2048/2016/07/14/607292_black_2048x2048.png"
                alt=""
              />
              <div class="clonar">
                <span class="material-symbols-outlined icone_opcoes">
                  folder_copy
                </span>
              </div>
            </div>

            <span class="material-symbols-outlined direita arrasto">
              drag_indicator
            </span>
          </div>
          <span
            class="material-symbols-outlined esquerda_15 icone_opcoes delete"
          >
            delete
          </span>
        </div>
      </div>
      <div class="conteudo_ata flex align justify">
        <div class="" id="area_arrastavel"></div>
      </div>
    </div>
    <!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
    <script>
      //Function para montar o menu de seleção de data e tipo de reunião
      carrega_menu_data_e_tipo_de_reuniao();

      cards = [];

      cards_padrão = [
        // {
        //   card: 1,
        //   posicao_no_card: 1,
        //   label: "Anúncio:",
        //   tipo: "texto_livre",
        //   elemento_oculto: 0,
        //   value: "",
        // },
        // {
        //   card: 1,
        //   posicao_no_card: 2,
        //   label: "Data:",
        //   tipo: "data",
        //   elemento_oculto: 0,
        //   value: "",
        // },
        // {
        //   card: 1,
        //   posicao_no_card: 3,
        //   label: "Local",
        //   tipo: "texto_livre",
        //   elemento_oculto: 0,
        // },
        // {
        //   card: 1,
        //   posicao_no_card: 1,
        //   label: "Observações:",
        //   tipo: "texto_livre",
        //   elemento_oculto: 1,
        // },
        // {
        //   card: 2,
        //   posicao_no_card: 1,
        //   label: "Hino de Abertura:",
        //   tipo: "hinos",
        //   elemento_oculto: 0,
        //   value: "",
        // },
        // {
        //   card: 3,
        //   posicao_no_card: 1,
        //   label: "Oração:",
        //   tipo: "nomes",
        //   elemento_oculto: 0,
        //   value: "",
        // },
        // {
        //   card: 3,
        //   posicao_no_card: 2,
        //   label: "Teste Oculto:",
        //   tipo: "nomes",
        //   elemento_oculto: 1,
        // },
        // {
        //   card: 4,
        //   elemento_oculto: 0,
        //   label: "Discursante:",
        //   posicao_no_card: null,
        //   tipo: "nomes",
        //   value: "",
        // },
        // {
        //   card: 4,
        //   elemento_oculto: 1,
        //   label: "Tema:",
        //   posicao_no_card: null,
        //   tipo: "texto_livre",
        //   value: "",
        // },
        // {
        //   card: 4,
        //   elemento_oculto: 1,
        //   label: "Duração:",
        //   posicao_no_card: null,
        //   tipo: "texto_livre",
        //   value: "",
        // },
        // {
        //   card: 5,
        //   elemento_oculto: 0,
        //   label: "Regente:",
        //   posicao_no_card: null,
        //   tipo: "nomes",
        //   value: "",
        // },
        // {
        //   card: 6,
        //   elemento_oculto: 0,
        //   label: "Organista:",
        //   posicao_no_card: null,
        //   tipo: "nomes",
        //   value: "",
        // },
      ];

      function arrasto() {
        document.querySelectorAll(".draggable").forEach(function (element) {
          // Adiciona os listeners de eventos para os eventos de arrastar
          element.addEventListener("dragstart", dragStart);
          element.addEventListener("dragend", dragEnd);
        });

        document
          .querySelectorAll("#area_arrastavel")
          .forEach(function (element) {
            // Adiciona os listeners de eventos para os eventos de soltar
            element.addEventListener("dragover", movimentacao_elemento);
            element.addEventListener("drop", movimentacao_elemento);
          });
      }

      function dragover() {
        event.preventDefault();
      }

      // Função chamada quando o arrasto inicia
      function dragStart(event) {
        //A Etiqueta de arrasto terá a aparência do próprio elemento
        event.dataTransfer.setData("text/plain", event.target.id);
        // Deixa opaco o elemento que está sendo arrastado
        this.classList.add("dragging");
      }

      // Função chamada quando o arrasto termina
      function dragEnd() {
        // Remove a classe de estilização
        this.classList.remove("dragging");
      }
      troca_anterior = null;
      function movimentacao_elemento(event) {
        event.preventDefault();

        arrastando = document.querySelector(".dragging");

        mouse_em = document.elementFromPoint(event.clientX, event.clientY);

        elemento_referencia = null;

        if (
          arrastando.id < mouse_em.id &&
          mouse_em.id != "area_arrastavel" &&
          arrastando.id != mouse_em.id
        ) {
          //"cima_baixo"
          elemento_referencia = parseInt(mouse_em.closest(".div_card").id) + 1;
        } else if (
          mouse_em.id != "area_arrastavel" &&
          arrastando.id != mouse_em.id
        ) {
          //"baixo_cima"
          elemento_referencia = parseInt(mouse_em.closest(".div_card").id);
        }

        troca_atual = arrastando.id + "e" + mouse_em.id;

        if (
          elemento_referencia != null &&
          parseInt(elemento_referencia.id) != null &&
          troca_atual != troca_anterior
        ) {
          elemento_referencia = document.getElementById(elemento_referencia);

          document
            .querySelector("#area_arrastavel")
            .insertBefore(arrastando, elemento_referencia);

          troca_anterior = mouse_em.id + "e" + arrastando.id;

          reorganizeIDs();

          if (event.type === "drop") {
            troca_anterior = null;
          } else {
            setTimeout(() => {
              troca_anterior = null;
            }, 1300);
          }
        }
      }

      function reorganizeIDs() {
        $("#area_arrastavel .draggable").each(function (index) {
          $(this).attr("id", index + 1);
          numero_de_cards = index + 1;
        });
      }

      function opcoes_card() {
        conteudo_div_selecionada = this.closest(".div_card");

        if (this.id === "" || this.id === "fechada") {
          // conteudo_div_selecionada.querySelector(
          //   ".div_card_info_adicionais"
          // ).style.display = "flex";

          conteudo_div_selecionada
            .querySelectorAll(".icone_opcoes, .div_card_info_adicionais")
            .forEach(function (element) {
              element.style.display = "flex";
            });

          conteudo_div_selecionada.querySelector(".arrasto").style.background =
            " #fff";

          conteudo_div_selecionada.querySelector(
            ".div_opcoes_card"
          ).style.backgroundSize = "100% 100%";

          this.id = "aberta";
        } else {
          // conteudo_div_selecionada.querySelector(
          //   ".div_card_info_adicionais"
          // ).style.display = "none";

          conteudo_div_selecionada
            .querySelectorAll(".icone_opcoes, .div_card_info_adicionais")
            .forEach(function (element) {
              element.style.display = "none";
            });

          conteudo_div_selecionada.querySelector(
            ".div_opcoes_card"
          ).style.backgroundSize = "100% 0%";

          conteudo_div_selecionada.querySelector(".arrasto").style.background =
            "#51acc3";

          this.id = "fechada";
        }
      }

      function buscar_valores(caixa_texto_id) {
        const input = caixa_texto_id;
        input.style.color = "#002b52";
        const filter = input.value.toLowerCase();
        const dropdown =
          caixa_texto_id.parentElement.querySelector(".dropdown-content");
        dropdown.innerHTML = "";
        texto_digitado_invalido = true;

        dropdown.style.display = "block"; //comentar na opção 1

        valores = [];
        if (input.id === "nomes") {
          valores = nomes;
        } else if (input.id === "hinos") {
          valores = hinos;
        } else if (input.id === "chamados") {
          valores = chamados;
        }

        valores.forEach((valor) => {
          if (valor.toLowerCase().includes(filter)) {
            input.style.color = "#002b52";
            const nameElement = document.createElement("a");
            nameElement.textContent = valor;
            nameElement.onclick = function () {
              input.value = valor;
              dropdown.style.display = "none";
              ajusta_altura_area_texto(caixa_texto_id);
            };
            dropdown.appendChild(nameElement);

            texto_digitado_invalido = false;
          }
        });

        if (texto_digitado_invalido && filter !== "" && valores.length != 0) {
          input.style.color = "#9a0909";
          dropdown.style.display = "none";
          dropdown.innerHTML = "";
        }

        if (filter === "" || valores.length === 0) {
          dropdown.style.display = "none";
        }
      }

      // // Fechar dropdown e limpar input quando clicar fora do dropdown
      window.addEventListener("click", function (event) {
        if (
          !event.target.matches(".dropdown") &&
          !event.target.matches(".dropdown a") &&
          !event.target.matches(".area_texto")
        ) {
          document
            .querySelectorAll(".dropdown-content")
            .forEach(function (element) {
              if (
                element.style.display != "none" &&
                element.style.display != ""
              ) {
                element.style.display = "none";
                if (!valor_texto) {
                  element.parentElement.querySelector(
                    ".area_texto"
                  ).style.color = "#9a0909";
                }
              }
            });
        }
      });

      function ajusta_altura_area_texto(caixa_texto_id) {
        valor_texto = false;
        if (event.type === "click") {
          //clicou
          area_texto = caixa_texto_id;
          valor_texto = true;
        } else {
          //digitou
          area_texto = this;
        }

        area_texto.style.height = "19px";
        area_texto.style.height = area_texto.scrollHeight - 10 + "px";

        conteudo_div_selecionada = area_texto.closest(".div_card");

        conteudo_div_selecionada.querySelector(".img_canto").style.height =
          "100%";

        if (event.type === "input") {
          caixa_texto_id = area_texto;
          buscar_valores(caixa_texto_id);
        }
      }

      function atualiza_ouvintes() {
        document
          .querySelectorAll("#deleta_elemento_inserir_card")
          .forEach(function (element) {
            element.addEventListener("click", excluir_elemento_form_criacao);
          });

        document.querySelectorAll(".arrasto").forEach(function (element) {
          element.addEventListener("click", opcoes_card);
        });

        document.querySelectorAll(".area_texto").forEach(function (element) {
          element.addEventListener("input", ajusta_altura_area_texto);
          element.addEventListener("onload", ajusta_altura_area_texto);
        });

        document.querySelectorAll(".delete").forEach(function (element) {
          element.addEventListener("click", deletar_card);
        });
        arrasto();
        // $(".arrasto").on("click", opcoes_card);
        insere_hora_campo_data_vazio();

        document.querySelectorAll(".clonar").forEach(function (element) {
          element.addEventListener("click", clonar_elemento);
        });

        $(".copiar").on("click", copiar);

        // $(".div_img_icone_whats").on("click", preparar_texto_card_whatsapp);

        document
          .querySelectorAll(".div_img_icone_whats")
          .forEach(function (element) {
            element.addEventListener("click", preparar_texto_card_whatsapp);
          });

        $("#botao_criar_card_novo").on("click", botao_criar_card_novo);
        $("#botao_adicionar_card_pronto").on(
          "click",
          botao_adicionar_card_pronto
        );

        document
          .querySelectorAll("#adicionar_elemento")
          .forEach(function (element) {
            element.addEventListener("click", f_adicionar_elemento);
          });

        document
          .querySelectorAll("#adicionar_elemento_oculto")
          .forEach(function (element) {
            element.addEventListener("click", f_adicionar_elemento_oculto);
          });

        // $("#salvar_adicionar_card_pronto").on(
        //   "click",
        //   salvar_adicionar_card_pronto
        // );

        // document
        //   .querySelector("#salvar_adicionar_card_pronto")
        //   .addEventListener("click", salvar_adicionar_card_pronto);

        $("#salvar_adicionar_card_pronto").on(
          "click",
          salvar_adicionar_card_pronto
        );

        document
          .querySelectorAll("#botao_salvar_novo_card")
          .forEach(function (element) {
            element.addEventListener("click", salvar_novo_card);
          });

        $(".botao_fechar_novo_card").on("click", fechar_tela_novo_card);

        
        
      }
      atualiza_ouvintes();

      $("#enviar_texto_completo_da_ata_via_whatsapp").on('click',enviar_texto_completo_da_ata_via_whatsapp);

      $("#copiar_texto_completo_da_ata").on('click',copiar_texto_completo_da_ata);

      function mostrar_dia_semana_campo_data(element) {
        var diasSemana = [
          "Domingo",
          "Seg.feira",
          "Ter.feira",
          "Qua.feira",
          "Qui.feira",
          "Sex.feira",
          "Sábado",
        ];

        element.parentElement.querySelector("#diaSemana").textContent =
          diasSemana[new Date(element.value + "T" + "00:00").getDay()];
      }

      insere_hora_campo_data_vazio();
      function insere_hora_campo_data_vazio() {
        document.querySelectorAll("#data").forEach(function (element) {
          if (element.value === "") {
            element.valueAsDate = new Date();
            mostrar_dia_semana_campo_data(element);

            var dataAtual = new Date();

            var horaAtual = dataAtual.getHours();

            dataAtual.setMinutes(0);

            var horaFormatada = dataAtual.toLocaleTimeString([], {
              hour: "2-digit",
              minute: "2-digit",
            });

            element.parentElement.querySelector("#hora").value = horaFormatada;
          }
        });
      }

      function atualiza_data_campo(element) {
        if (element.value === "") {
          element.valueAsDate = new Date();
        }
      }

      function deletar_card() {
        this.closest(".div_card").remove();
      }

      function separar_array() {
        // Objeto para armazenar os cards agrupados
        cardsAgrupados = {};

        // Iterando sobre o array de dados
        cards.forEach((item) => {
          // Verificando se o card já existe no objeto de cards agrupados
          if (!cardsAgrupados[item.card]) {
            // Se não existe, criamos um novo array para esse card
            cardsAgrupados[item.card] = [];
          }
          // Adicionamos o item atual ao array correspondente ao seu card
          cardsAgrupados[item.card].push(item);
        });
      }

      numero_de_cards = 0;
      function carrega_dados() {
        separar_array();
        // document.querySelector("#area_arrastavel").innerHTML = '';

        // Agora, vamos renderizar os cards
        for (const card in cardsAgrupados) {
          if (Object.hasOwnProperty.call(cardsAgrupados, card)) {
            //clona o card padrão
            card_novo = document.querySelector("#card_padrão").cloneNode(true);

            //insere o card clone criado na área arrastável
            document.querySelector("#area_arrastavel").appendChild(card_novo);

            //cria uma referência para inserir os elementos visiveis
            referencia = card_novo.querySelector(".div_card_info_adicionais");

            //atualiza o id do novo card criado
            card_novo.id = numero_de_cards + 1;
            cardsAgrupados[card].forEach((element) => {
              //clona a etiqueta
              campo_label = card_novo
                .querySelector(".campo_titulo")
                .cloneNode(true);

              //clona o campo de data
              campo_data = card_novo
                .querySelector(".div_novo_card_campo_data")
                .cloneNode(true);

              //clona o campo de texto
              campo_texto = card_novo
                .querySelector(".div_novo_card_campo_texto")
                .cloneNode(true);

              //captura a etiqueta
              campo_label.textContent = element.label;

              //Captura o campo que sera inserido
              if (element.tipo === "data") {
                //Se a data tem valor predefinido Insere o valor da data
                element.value
                  ? (campo_data.querySelector("#data").value =
                      element.value.substr(0, 10))
                  : "";

                //Se a hora tem valor predefinido Insere o valor da hora
                element.value
                  ? (campo_data.querySelector("#hora").value =
                      element.value.substr(11, 5))
                  : "";

                tipo_de_campo = campo_data;
              } else {
                campo_texto.querySelector(".text_area_padrão_novo_card").id =
                  element.tipo;

                element.value
                  ? (campo_texto.querySelector("#" + element.tipo).value =
                      element.value)
                  : "";

                tipo_de_campo = campo_texto;
              }

              //cria uma div e insere os elementos
              campo_card_com_label = document.createElement("div");
              campo_card_com_label.id = "campo_card_com_label";
              campo_card_com_label.appendChild(campo_label);
              campo_card_com_label.appendChild(tipo_de_campo);

              //insere os elementos na div (caso seja oculta insere na div oculta).
              if (element.elemento_oculto === 1) {
                div_card_info_adicionais = card_novo
                  .querySelector(".div_card_info")
                  .querySelector(".div_card_info_adicionais");
                div_card_info_adicionais.appendChild(campo_card_com_label);
              } else {
                div_card_info = card_novo.querySelector(".div_card_info");
                div_card_info.insertBefore(campo_card_com_label, referencia);
              }

              //ajusta altura dos elementos de texto
              area_texto = campo_texto.querySelector(".area_texto");
              area_texto.style.height = "19px";
              area_texto.style.height = area_texto.scrollHeight - 10 + "px";

              //torna o novo card visivel
              card_novo.style.display = "flex";

              //atualiza os ouvintes para ativar a funcionalidade dos botões do novo card
              atualiza_ouvintes();

              // fechar_tela_novo_card();
            });
            //remove os campos padrão do card clonado
            card_novo.querySelector(".div_campos_padrão_novo_card").remove();
          }
        }
        reorganizeIDs();
      }

      
      function captura_dados() {
        capturados = [];
        aqui = document
          .querySelector("#area_arrastavel")
          .querySelectorAll("#campo_card_com_label"); //$('#area_arrastavel')

        aqui.forEach(function (element) {
          tipo = element.querySelector("textarea, input[type=date]").id;
          if (tipo === "data") {
            value =
              element.querySelector(" input[type=date]").value +
              "T" +
              element.querySelector(" input[type=time]").value;
          } else {
            value = element.querySelector("textarea").value;
          }
          if (element.closest(".div_card_info_adicionais")) {
            elemento_oculto = 1;
          } else {
            elemento_oculto = 0;
          }

          capturados.push({
            card: element.closest(".div_card").id,
            posicao_no_card: null,
            label: element.querySelector("label").textContent,
            tipo: tipo,
            elemento_oculto: elemento_oculto,
            value: value,
            data_da_ata: data_da_ata,
            tipo_de_ata: tipo_de_ata,
            id_ata: id_ata,
          });
        });
        // console.log(capturados);
      }

      function obter_id_ata(){
        url='/obter_id_ata';
        data_da_ata_para_obter_ID = document.querySelector('#data').value;
        data_da_ata_para_obter_ID = `'${data_da_ata_para_obter_ID}'`;
        tipo_de_ata_para_obter_ID = document.querySelector('#tipo').value;

        $.ajax({
          url:url,
          data:{data_da_ata_para_obter_ID,tipo_de_ata_para_obter_ID},
          success: function(result){
            id_ata = result.id_ata;
            obter_dados_de_ata_no_banco();
          },
          error: function(data){console.log(data)},
        });

        atualiza_variaveis_data_da_ata_e_tipo_de_ata();
      }

      function clonar_elemento() {
        elemento_atual = this.closest(".div_card");

        clone = elemento_atual.cloneNode(true);

        elemento_atual
          .querySelectorAll("textarea, input[type=date], input[type=time]")
          .forEach(function (element) {
            element.value = "";

            if (element.type === "textarea") {
              element.style.height = "19px";
            }
          });
        document
          .querySelector("#area_arrastavel")
          .insertBefore(clone, elemento_atual);

        atualiza_ouvintes();
        reorganizeIDs();
      }

      //Adiciona Opções de CARD Padrão
      // Array para armazenar os labels dos primeiros objetos de cada card
      var opcoes_para_select = [];

      // Objeto para rastrear quais cards já foram processados
      var cardsProcessados = {};

      // Itera sobre o array cards_padrão
      function atualizar_cards_padrao(){
        cards_padrão.forEach((card) => {
          // Verifica se o card já foi processado
          if (!cardsProcessados[card.card]) {
            // Adiciona o label do primeiro objeto do card ao array
            opcoes_para_select.push({ card: card.card, label: card.label });

            select_de_opcoes = document.getElementById("insere_novo_card_pronto");

            var nova_opcao = document.createElement("option");
            nova_opcao.value = card.card;
            nova_opcao.textContent = card.label.slice(0, -1);
            select_de_opcoes.appendChild(nova_opcao);

            // Marca o card como processado
            cardsProcessados[card.card] = true;
          }
        });
      }

      function copiar(div_selecionada) {
        captura_dados();
        
        if (div_selecionada instanceof HTMLElement) {
          div = div_selecionada;
        } else {
          div = this.closest(".div_card");
        }

        // if (event.type === "click") {
        //   div = this.closest(".div_card");
        // } else {
        //   div = div_selecionada;
        // }

        dados_da_div = capturados.filter((card) => card.card === div.id);

        texto = "";

        dados_da_div.forEach(function (element) {
          if (element.tipo === "data") {
            valor = formatar_data_hora(element.value);
          } else {
            valor = element.value;
          }

          texto = texto + element.label + " " + valor + "\n";
        });
        
        copiar_texto(texto);
        return texto;
      }

      function copiar_texto(texto) {
        
        textarea = document.createElement("textarea");
        textarea.value = texto;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand("copy");
        textarea.remove();
        
        return texto;
      }

      function formatar_data_hora(data) {
        //Formato recebido 2024-03-12T19:00
        // Extrai os componentes da data
        let dia = data.substr(8, 2);
        let mes = data.substr(5, 2);
        let ano = data.substr(0, 4);
        let horas = data.substr(11, 2);
        let minutos = data.substr(14, 2);

        // Retorna a data formatada
        var data_formatada =
          dia + "/" + mes + "/" + ano + " às " + horas + ":" + minutos;

        return data_formatada;
      }

      function preparar_texto_card_whatsapp() {
        // captura_dados();

        div = this.closest(".div_card");

        nomes_concatenados = "";

        div.querySelectorAll("#nomes").forEach(function (element) {
          nome = element.value;

          // Divide a string pelo espaço em branco
          partesNome = nome.split(" ");

          // O primeiro nome é a primeira parte do array resultante
          nome = partesNome[0];

          nomes_concatenados = nomes_concatenados + " " + nome /*+ ","*/;
        });

        // data_e_tipo_de_reuniao = captura_data_e_tipo_de_reuniao();

        convite = `Olá ${nomes_concatenados} tudo bem? O Bispado lhe estende o convite para participar da ${data_e_tipo_de_reuniao}, cumprindo a seguinte designação: \n`;

        copiado = copiar(div);
        
        designacao = div.querySelector(".campo_titulo").textContent;
        hinos = "";
        if (designacao === "Regente: " || designacao === "Organista: ") {
          document.querySelectorAll("#hinos").forEach(function (hino) {
            hinos =
              hinos +
              "\n" + 
              hino
                .closest("#campo_card_com_label")
                .querySelector(".campo_titulo").textContent +
              " " +
              hino.value;
          });

          copiado = copiado + hinos;
        } else if (designacao === "Discursante:") {
          orientacao_discursante =
            "Por favor siga as instruções do documento a seguir:";
          copiado = copiado + "\n" + orientacao_discursante;
        } else if (designacao.substr(0, 7) === "Oração:") {
          orientacao_oracao =
            "Por favor, esteja no púlpito antes que o hino termine, não espere o hino acabar para subir ao estrado.";
          copiado = copiado + "\n" + orientacao_oracao;
        }

        texto = convite + "\n" + copiado;
        // console.log(texto);
        enviar_via_whatsapp(texto);
      }

      //enviar um texto via whatsapp
      function enviar_via_whatsapp(texto) {
        texto = encodeURIComponent(texto);

        link = `https://api.whatsapp.com/send?phone=${telefone_do_usuario_logado}&text=${texto}`;

        window.open(link, "_blank");
      }

      //Card Pronto
      function botao_adicionar_card_pronto() {
        cobertura.html("");
        cobertura.css("display", "flex", "position", "fixed");
        clone_adicionar_card_existente.css("display", "flex");
        cobertura.append(clone_adicionar_card_existente);
        atualiza_ouvintes();
        subir_ao_topo();
      }

      cobertura = $(".cobertura_content");
      clone_adicionar_card_existente = $("#adicionar_card_existente");

      function salvar_adicionar_card_pronto() {
        select_de_opcoes = document.getElementById("insere_novo_card_pronto");
        card_selecionado = select_de_opcoes.value;

        var array_card_selecionado = cards_padrão.filter(
          (card) => card.card === parseInt(card_selecionado)
        );

        cards = [];
        cards = array_card_selecionado;

        carrega_dados();
        fechar_tela_novo_card();
      }

      //Novo Card
      clone_criar_card_novo = $("#novo_card");
      function botao_criar_card_novo() {
        cobertura.html("");
        cobertura.css("display", "flex", "position", "fixed");
        clone_criar_card_novo.css("display", "flex");
        cobertura.append(clone_criar_card_novo);
        atualiza_ouvintes();
        subir_ao_topo();
      }

      function salvar_novo_card() {
        cards = [];
        document
          .querySelector("#novo_card")
          .querySelectorAll("select")
          .forEach(function (element) {
            if (element.type === "select-one") {
              //identifica se o elemento é oculto
              if (element.closest(".div_card_info_adicionais")) {
                elemento_oculto = 1;
              } else {
                elemento_oculto = 0;
              }

              cards.push({
                card: 1,
                posicao_no_card: null,
                label:
                  element.parentElement.parentElement.querySelector("#nome")
                    .value,
                tipo: element.value,
                elemento_oculto: elemento_oculto,
              });
            }
          });
        carrega_dados();

        //Limpar o Formulário
        div_novo_card = document.querySelector("#novo_card");
        elementos_a_remover =
          div_novo_card.querySelectorAll(".opcoes_novo_card");

        elementos_a_remover.forEach(function (element) {
          element.remove();
        });
        elementoReferencia = div_novo_card.querySelector("#adicionar_elemento");
        divInfoAdicionais = div_novo_card.querySelector(".div_card_info");
        adicionarElemento(divInfoAdicionais, elementoReferencia);

        fechar_tela_novo_card();
      }

      //Adiciona Elemento Para novo CARD
      function f_adicionar_elemento_oculto() {
        var divInfoAdicionais = this.closest(".div_card").querySelector(
          ".div_card_info_adicionais"
        );
        var elementoReferencia = this;
        adicionarElemento(divInfoAdicionais, elementoReferencia);
      }

      function f_adicionar_elemento() {
        var divInfoAdicionais =
          this.closest(".div_card").querySelector(".div_card_info");

        var elementoReferencia = this;
        adicionarElemento(divInfoAdicionais, elementoReferencia);
      }

      opcoes_novo_card_clone = document
        .querySelector(".opcoes_novo_card")
        .cloneNode(true);

      function adicionarElemento(divInfoAdicionais, elementoReferencia) {
        opcoes_novo_card = opcoes_novo_card_clone.cloneNode(true);
        divInfoAdicionais.insertBefore(opcoes_novo_card, elementoReferencia);
        atualiza_ouvintes();
      }

      //Remove elemento o novo CARD
      function excluir_elemento_form_criacao() {
        this.closest(".elemento").remove();
      }

      //Fecha a cobertura e seu conteúdo
      function fechar_tela_novo_card() {
        cobertura.css("display", "none", "position", "absolute");
      }

      $(".cobertura_content").on("click", fechar_cobertura);
      function fechar_cobertura() {
        if (event.target.className === "cobertura_content") {
          cobertura.css("display", "none", "position", "absolute");
        }
      }

      // //Copiar Texto completo da Ata
      // botao = document.createElement("button");
      // botao.textContent = "prepara_texto_completo_da_ata";
      // botao.id = "prepara_texto_completo_da_ata";
      // botao.onclick = prepara_texto_completo_da_ata;
      // vbotao_adicionar_card_pronto = document.querySelector(
      //   "#botao_adicionar_card_pronto"
      // );
      // document
      //   .querySelector(".div_botao_adicionar_elemento_pronto")
      //   .insertBefore(botao, vbotao_adicionar_card_pronto);

      function prepara_texto_completo_da_ata() {
        captura_dados();
        let conteudo_texto_completo_da_ata = "";
        let card_em_tratamento = null;

        //Repassa todos os dados capturados transformando-os em um texto
        capturados.forEach(function (element) {
          card_a_tratar = element.card;

          //Pula uma linha no texto para separar os cards
          if (card_em_tratamento != card_a_tratar) {
            card_em_tratamento = card_a_tratar;
            conteudo_texto_completo_da_ata =
              conteudo_texto_completo_da_ata + "\n";
          }

          //Caso a linha corresponda a uma data faz o tratamento
          if (element.tipo === "data") {
            valor = formatar_data_hora(element.value);
          } else {
            valor = element.value;
          }

          //Adiciona informações ao texto
          conteudo_texto_completo_da_ata =
            conteudo_texto_completo_da_ata + "\n" +"*"+ element.label +"*"+ valor;
        });

        //Acrescenta Cabeçalho com informação de data_e_tipo_de_reuniao
        conteudo_texto_completo_da_ata = captura_data_e_tipo_de_reuniao() + conteudo_texto_completo_da_ata;

        return conteudo_texto_completo_da_ata;
      }

      function enviar_texto_completo_da_ata_via_whatsapp() {
        enviar_via_whatsapp(prepara_texto_completo_da_ata());
      }
      
      function copiar_texto_completo_da_ata() {
        copiar_texto(prepara_texto_completo_da_ata());
      }
      
      //Function para montar o menu de seleção de data e tipo de reunião
      function carrega_menu_data_e_tipo_de_reuniao(){
        $.ajax({
          url: '/ferramentas/frequencia',
          success: function(data){
            //Cria um objeto
            nova_div = document.createElement('div');

            //Adiciona ao objeto o conteúdo da página de registro de Frequência
            nova_div.innerHTML = data;

            //Cria uma variável contendo apenas o menu
            menu_data_e_tipo_de_reuniao = nova_div.querySelector('.div_registro_frequencia');

            //Ajusta o texto do Cabeçalho da Tela
            menu_data_e_tipo_de_reuniao.querySelector('label').innerText = 'Ata de Reunião';

            //Ajusta o Texto De descrição da tela
            menu_data_e_tipo_de_reuniao.querySelector('label').nextElementSibling.innerText = 'Serviço de Registro de Atas das Reuniões da Igreja.';

            //ajusta a cor do texto exibido
            menu_data_e_tipo_de_reuniao.querySelector('.configuracoes_frequencia').querySelectorAll('label').forEach(function(element){element.style.color = '#003057'});

            //Ajusta o texto descrição de exibição
            menu_data_e_tipo_de_reuniao.querySelector('#descricao').innerText = 'Exibindo Ata para:'

            //Atualiza as funções que serão chamadas ao alterar a data e o tipo de reunião
            menu_data_e_tipo_de_reuniao.querySelector('#data').onchange = captura_data_e_tipo_de_reuniao;
            menu_data_e_tipo_de_reuniao.querySelector('#tipo').onchange = captura_data_e_tipo_de_reuniao;
            
            //Insere o menu_data_e_tipo_de_reuniao na tela
            funcoes_gerais_da_ata = document.querySelector(
              "#botao_usar_ata_padrao"
            );

            document
              .querySelector("#funcoes_gerais_da_ata")
              .insertBefore(menu_data_e_tipo_de_reuniao, funcoes_gerais_da_ata);

              captura_data_e_tipo_de_reuniao();

              window.scrollTo({
                top: 400,
                behavior: "smooth",
              });
          },
          error: function(data){
            console.log(data);
          }
        })
      }

      
      //function para capturar data e tipo de reunião 
      function captura_data_e_tipo_de_reuniao(){
        //Captura data e tipo de reunião selecionados
        data = document.querySelector('#data');
        tipo = document.querySelector('#tipo');

        //Caso a data esteja vazia insere hoje
        if(data.valueAsDate === null){
          data.valueAsDate = new Date();
        }

        //Captura o Texto do Tipo de Reunião
        texto_do_tipo = tipo.options[tipo.selectedIndex].textContent;
        
        //Captura e formata para DD/MM/AAAA a data da reunião
        texto_da_data = data.value + 'T00:00';
        texto_da_data = formatar_data_hora(texto_da_data);
        texto_da_data = texto_da_data.substr(0,10)

        data_e_tipo_de_reuniao = texto_do_tipo +' do dia ' + texto_da_data;
        //Insere o tipo e data da reunião na indicador_topo
        document.querySelector('#indicador_topo').innerText = data_e_tipo_de_reuniao;

        //function que seta a data e o tipo de reunião
        obter_id_ata();
        atualiza_variaveis_data_da_ata_e_tipo_de_ata();
        carrega_dados();
        

        return data_e_tipo_de_reuniao;
      }

      function atualiza_variaveis_data_da_ata_e_tipo_de_ata(){
        //Seta as Variaveis
        data_da_ata = document.querySelector('#data').value;
        tipo_de_ata = document.querySelector('#tipo').value;
      }

      function subir_ao_topo(){
        window.scrollTo({
          top: 0,
          behavior: "smooth",
        });
      }



      // linear-gradient( to right, #bcdee7, #66b7ca, #50acc3, #0e94b4 )
      // linear-gradient( to bottom, #0e94b4, #50acc3, #66b7ca, #bcdee7)

      // Captura o estado da página antes de ser descarregada
      window.addEventListener('beforeunload', function(event) {
          // Capture o estado da página, por exemplo, usando localStorage
          localStorage.setItem('pageState', JSON.stringify({
              scrollTop: window.scrollY, // Posição de rolagem vertical
              // Outras informações de estado que você deseja capturar
          }));
      });

      // Restaura o estado da página quando o usuário volta
      window.addEventListener('load', function(event) {
          // Verifica se há um estado da página armazenado
          var pageState = localStorage.getItem('pageState');
          if (pageState) {
              // Restaura o estado da página
              pageState = JSON.parse(pageState);
              window.scrollTo(0, pageState.scrollTop); // Restaura a posição de rolagem vertical
              // Restaure outras informações de estado, se necessário
              // Por exemplo, você pode precisar restaurar os valores dos campos de formulário
          }
      });



      //funções para salvar o formulário:
      
      // //Verifica se a tela foi fechada ou minimizada a fim de salvar os dados atuais
      // document.addEventListener(
      //   "visibilitychange",
      //   verifica_tela_fechada_ou_minimizada_ou_descarregada
      // ); //minimiza

      // document.addEventListener(
      //   "beforeunload",
      //   verifica_tela_fechada_ou_minimizada_ou_descarregada
      // ); //
      

      // function verifica_tela_fechada_ou_minimizada_ou_descarregada(event) {
      //   if (
      //     event.type === "beforeunload"
      //     //|| document.visibilityState === "hidden" 
      //     //|| event.type === 'ajaxSend'
      //   ) {
      //     enviar_ata_para_o_banco();
      //   }
      // }

      //Salvamento automático em caso de fechar ou atualizar a aba
      window.addEventListener("beforeunload", salvar_antes_de_atualizar_tela);

      function salvar_antes_de_atualizar_tela(event) {
        //Salva as Informações
        enviar_ata_para_o_banco();

        //Burla o navegador segurando a página por tempo suficiente para envio da requisição
        novaJanela = window.open('', '_blank');
        setTimeout(function() {
            novaJanela.close();
        }, 0);
      }

      //Salvamento Automático: Intercepta qualquer ajax (redirecionamento / Deslogar) e salva o conteúdo da ata antes.
      salvar_antes_de_uma_requisicao_ajax();
      function salvar_antes_de_uma_requisicao_ajax(){
        $(document).on("ajaxSend", function(event, jqXHR, ajaxOptions) {
          if(document.querySelector("#area_arrastavel") != null){
            enviar_ata_para_o_banco();
          }else{
            $(document).off("ajaxSend");
            window.removeEventListener("beforeunload", salvar_antes_de_atualizar_tela);
          }
        });
      }
      
      function enviar_ata_para_o_banco(){
        captura_dados();

        //Cria variável ultimo_envio
        if(typeof ultimo_envio === 'undefined'){
          ultimo_envio = capturados;
        }
        
        //Verifica se o último envio é igual ao atual para não inserir no banco informação repetida
        if (JSON.stringify(ultimo_envio) !== JSON.stringify(capturados)) {
          //Atualiza o ultimo_envio
          ultimo_envio = capturados;
          data = JSON.stringify(capturados);
          console.log('Salvar Acionado');

          url = "/enviar_ata_para_o_banco";

          $(document).off("ajaxSend");
          $.ajax({
            url: url,
            type: "POST",
            data: {data: data,csrfmiddlewaretoken: token},
            success: function(data){
              //console.log(data);
              if(!$('#area_arrastavel')){
                obter_id_ata();
                salvar_antes_de_uma_requisicao_ajax();
                // alerta("Ata", "Ata Salva com Sucesso!", "success");
              }
            },
            error: function(data){
              console.log(data);
              alerta("Ata", "Erro ao salvar Ata!", "error");
              document.querySelector('body').innerHTML = data.responseText;
            }
          });
        }
      }

      function obter_dados_de_ata_no_banco(){
        data_da_ata = document.querySelector('#data').value;
        // data_da_ata = `'${data_da_ata}'`;
        tipo_de_ata = document.querySelector('#tipo').value;

        //data = [data_inicio: data_inicio]
        url = '/obter_dados_de_ata_no_banco';
        data = capturados;
        $(document).off("ajaxSend");
        $.ajax({
          url: url,
          data: {data_da_ata,tipo_de_ata,id_ata},
          success: function(data){
            document.querySelector("#area_arrastavel").innerHTML = '';
            cards = data.data;
            carrega_dados();
            captura_dados();
            ultimo_envio = capturados; 
            // console.log('entrou');
            // async function a(){
            //   captura_dados();
            //   ultimo_envio = capturados; 
            //   console.log('entrou');
            // };
            // a();
            salvar_antes_de_uma_requisicao_ajax();
          },
          error: function(data){console.log(data);}
        })
      }

      obter_informacoes_de_apoio();
      function obter_informacoes_de_apoio(){

        hinos = [];
        chamados = [];
        nomes=[];
        
        url = '/obter_informacoes_de_apoio';
        $.ajax({
          url:url,
          success: function(result){
            
            result.chamados.forEach(function(chamado){
              chamados.push(chamado.chamado)
            });
            
            result.hinos.forEach(function(hino){
              hinos.push(hino.hino)
            });

            result.nomes.forEach(function(nome){
              nomes.push(nome.nome_interno)
            });

            atas_padrao = result.atas_padrao;
            cards_padrão = result.cards_padrao;
            atualizar_cards_padrao();

            telefone_do_usuario_logado = telefone_do_usuario_logado;

          },
          error: function(result){console.log(result)},
        })
      }
      
      
      document.querySelector('#botao_usar_ata_padrao').addEventListener('click',usar_modelo_de_ata_padrao);

      function usar_modelo_de_ata_padrao(){
        console.log('chegou');

        ata_padrao_selecionada = atas_padrao.filter((ata_padrao) => ata_padrao.tipo_de_ata === parseInt(tipo_de_ata));

        console.log(ata_padrao_selecionada);

        cards = ata_padrao_selecionada;
        carrega_dados();
      }

      // Adiciona um ouvinte de eventos para o clique no botão
      // document.getElementById("botaoSalvar").addEventListener("click", function() {
      //     // Lógica para salvar aqui
      //     // alert("Salvando...");
      //     enviar_ata_para_o_banco();

      // });

        
    </script>
  </body>
</html>
