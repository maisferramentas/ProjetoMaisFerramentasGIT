<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Arrastar Divs</title>
    <style>
      body {
        font-family: Arial, sans-serif;
      }

      .container {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        padding: 10px;
      }

      .draggable {
        border: 1px solid #ccc;
        margin-bottom: 10px;
        padding: 10px;
        cursor: pointer;
        background-color: #fff;
        user-select: none;
      }

      .dragging {
        opacity: 0.5;
      }

      /* Adicionando estilos para melhorar a visualização em telas menores */
      @media screen and (max-width: 600px) {
        .draggable {
          width: 100%;
        }
      }
    </style>
  </head>
  <body>
    <div class="container" id="container">
      <div class="draggable" draggable="true" id="1">
        <span class="material-symbols-outlined drag_indicator">
          drag_indicator
        </span>
        <label for="">Elemento A</label>
        <input type="text" />
      </div>
      <div class="draggable" draggable="true" id="2">
        <span class="material-symbols-outlined drag_indicator">
          drag_indicator
        </span>
        <label for="">Elemento B</label>
        <input type="text" />
      </div>
      <div class="draggable" draggable="true" id="3">
        <span class="material-symbols-outlined drag_indicator">
          drag_indicator
        </span>
        <label for="">Elemento C</label>
        <input type="text" />
      </div>
    </div>

    <script>
      let dragStartIndex;
      let draggable;

      document.addEventListener("dragstart", (e) => {
        if (e.target.classList.contains("draggable")) {
          draggable = e.target;
          draggable.classList.add("dragging");
          dragStartIndex = +draggable.id;
        }
      });

      document.addEventListener("dragend", (e) => {
        if (draggable) {
          draggable.classList.remove("dragging");
          updateIds();
          draggable = null;
        }
      });

      document.addEventListener("dragover", (e) => {
        e.preventDefault();
        const afterElement = getDragAfterElement(e.clientY);
        if (afterElement == null) {
          container.appendChild(draggable);
        } else {
          container.insertBefore(draggable, afterElement);
        }
      });

      function getDragAfterElement(y) {
        const draggableElements = [
          ...document.querySelectorAll(".draggable:not(.dragging)"),
        ];
        return draggableElements.reduce(
          (closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) {
              return { offset: offset, element: child };
            } else {
              return closest;
            }
          },
          { offset: Number.NEGATIVE_INFINITY }
        ).element;
      }

      function updateIds() {
        const draggables = document.querySelectorAll(".draggable");
        draggables.forEach((draggable, index) => {
          draggable.id = index + 1;
        });
      }
    </script>
  </body>
</html>
