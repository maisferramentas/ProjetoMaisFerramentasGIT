<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title></title>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f0f0f0;
        margin: 0;
        padding: 0;
    }

    .div_lista_de_aniversariantes p {
        color: #555;
        margin: 0;
    }
    .div_lista_de_aniversariantes {
        display:flex;
        max-width: 400px;
        flex-direction: column;
        justify-content: center;
        
    }
    .card{
        display: flex;
        margin-bottom: 10px;
    }
    .card_padrao{
        display: flex;
        margin-bottom: 10px;
        display: none;
    }
    .informacao_complementar_do_card{
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
</style>
</head>
<body>
    <div class="conteudo" id="conteudo">
        <h1>Aniversariantes</h1>
        <label for="data_inicio">Data Referência: </label>
        <input type="date" name="" id="data_inicio">

        <!-- <label for="data_inicio">Data Início: </label>
        <input type="date" name="" id="data_inicio"> -->

        <!-- <label for="data_fim">Data Final: </label>
        <input type="date" name="" id="data_fim"> -->

        <h3>Aniversariantes do Dia:</h3>
        <div class="aniversariantes_do_dia"></div>

        <h3>Aniversariantes do Dia Seguinte:</h3>
        <div class="aniversariantes_do_dia_seguinte"></div>
        
        <h3>Aniversariantes do Mês:</h3>
        <div class="aniversariantes_do_mes"></div>

        <h3>Aniversariantes do Ano:</h3>
        <div class="aniversariantes_do_ano"></div>

        <!-- INICIO card padrão para clonar e replicar -->
        <div class="div_lista_de_aniversariantes" >
            <div class="card_padrao">
                <svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#5f6368"><path d="M480-242q-67 0-129 23.5T235-149v9h490v-9q-54-46-116-69.5T480-242Zm0-60q74 0 139.5 24.5T740-211v-609H220v609q55-42 120.5-66.5T480-302Zm2-139q-32.5 0-55.25-22.75T404-519q0-32.5 22.75-55.25T482-597q32.5 0 55.25 22.75T560-519q0 32.5-22.75 55.25T482-441ZM220-80q-24 0-42-18t-18-42v-680q0-24 18-42t42-18h520q24 0 42 18t18 42v680q0 24-18 42t-42 18H220Zm262-301q58 0 98-40t40-98q0-58-40-98t-98-40q-58 0-98 40t-40 98q0 58 40 98t98 40Zm-2-138Z"/></svg>
                <div class="informacao_complementar_do_card" >
                    <p id="nome">Leudacy Batista Scherner</p> 
                    <p id="data_idade_organizacao">12/04/1930 (94 anos) S. Socorro </p> 
                </div>
            </div>
        </div>
        <!-- FIM card padrão para clonar e replicar -->

    </div>
</body>
<script>
    //Captura o campo de tada
    var data_inicio = $('#data_inicio');
    var data_fim = $('#data_fim');
    
    //Declara data atual
    var hoje = new Date();

    // Ajusta o fuso horário para GMT-03:00 (180 minutos antes de UTC)
    hoje.setMinutes(hoje.getMinutes() -180);

    //Formata para dar valor ao campo de data
    var hojeFormatado = hoje.toISOString().split('T')[0];

    //Atribui valor ao campo de data
    data_inicio.val(hojeFormatado);
    data_fim.val(hojeFormatado);

    //Atribui uma função para a alteração do campo
    data_inicio.on('change', alterar_data_selecionada);
    data_fim.on('change', alterar_data_selecionada);

    //Chama função para atualizar variavel data_selecionada
    alterar_data_selecionada();

    function alterar_data_selecionada(){
        value_data_inicio = data_inicio.val();
        value_data_fim = data_fim.val();
    }
    
    //Obtem do banco todas os aniversariantes
    obter_dados_aniversariantes();
    function obter_dados_aniversariantes(){
        var url = '/obter_dados_aniversariantes';
        var sucesso = validar_dados_aniversariantes;
        $.ajax({
            url:url,
            success: function(result){
                sucesso(result);
            },
            error: function(result){console.log(result)},
        });
    }

    function validar_dados_aniversariantes(result){
        //Captura o array retornado
        dados_aniversariantes = result.dados_aniversariantes;

        //Captura as datas selecionadas
        
        // filtra a Data selecionada
        data_selecionada = new Date(data_inicio);
        dia_selecionado = data_selecionada.getDate();
        mes_selecionado = data_selecionada.getMonth()+1;

        aniversariantes_do_ano = dados_aniversariantes;

        aniversariantes_do_mes = dados_aniversariantes.filter((element) => parseInt(element.data_aniversário.substr(5,2)) === mes_selecionado);

        aniversariantes_do_dia = dados_aniversariantes.filter((element) => parseInt(element.data_aniversário.substr(5,2)) === mes_selecionado && parseInt(element.data_aniversário.substr(8,2)) === dia_selecionado);

        aniversariantes_do_dia_seguinte = dados_aniversariantes.filter((element) => parseInt(element.data_aniversário.substr(5,2)) === mes_selecionado && parseInt(element.data_aniversário.substr(8,2)) === dia_selecionado+1);

        exibir_na_tela(aniversariantes_do_ano, 'aniversariantes_do_ano');
    }

    const copia_card_padrao = $('.div_lista_de_aniversariantes').clone();
    function exibir_na_tela(dados,div) {
        console.log(dados);
        // div = `'.${div}'`
        // div = $(div);

        var div_lista_de_aniversariantes = $('.div_lista_de_aniversariantes');

        dados.forEach(function(element) {
            copia_card_padrao.find('#nome').text(element.nome_interno);

            var data_idade_organizacao = 
                formatar_data(element.data_aniversário) + ' (' +
                element.idade + ' anos) ' +
                element.organizacao;

            copia_card_padrao.find('#data_idade_organizacao').text(data_idade_organizacao);
            
            copia_card_padrao.find('.card_padrao').addClass('card');
            copia_card_padrao.find('.card_padrao').removeClass('card_padrao');

            div_lista_de_aniversariantes.append(copia_card_padrao.html());
        });
    }

    function formatar_data(element){
        dia = element.substr(8,2);
        if(dia < 9){dia = '0'+dia;};

        mes = element.substr(5,2);

        ano = element.substr(0,4);

        data_formatada = dia+'/'+mes+'/'+ano;
        return data_formatada;
    }
</script>
</html>